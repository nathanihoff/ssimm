---
output:
  bookdown::pdf_document2:
    toc: no
    number_sections: yes
    pandoc_args: !expr rmdfiltr::add_wordcount_filter(rmdfiltr::add_citeproc_filter(args = NULL))
    latex_engine: xelatex
    keep_tex: yes
    #template: svm-latex-ms.tex
# output: 
#   pdf_document:
#     citation_package: natbib
#     keep_tex: true
#     fig_caption: true
#     latex_engine: pdflatex
#     template: svm-latex-ms.tex
header-includes:
  # - \usepackage{setspace}\doublespace
  # - \usepackage{endnotes}
  #- \let\footnote=\endnote
  #- \usepackage{endfloat}
  - \usepackage{fancyhdr}
  - \pagestyle{fancy}
  - \setlength{\headheight}{13.6pt}
  - \rhead{\textit{Hoffmann and Velasco}}
  - \lhead{\textit{`r format(Sys.time(), '%B %e, %Y')`}}
editor_options: 
  chunk_output_type: console
  
citeproc: no
fontfamily: mathpazo
fontsize: 11pt
geometry: margin=1in
indent: yes
link-citations: yes
linkcolor: blue
bibliography: zotero.bib  
csl: apa.csl


title: "Making Migration Sexy: How State and National Policies Influence International Migration of Same-Sex Couples"
date: "`r format(Sys.time(), '%B %e, %Y')`"
# author:
# - name: Nathan I. Hoffmann
#   affiliation: Department of Sociology, University of California, Los Angeles
# - name: Kristopher Velasco
#   affiliation: Department of Sociology, Princeton University
 
author:
- Nathan I. Hoffmann, Department of Sociology, University of California, Los Angeles
- Kristopher Velasco, Department of Sociology, Princeton University

abstract: "As same-sex couples gain greater social acceptance and new rights, their numbers reported on surveys in the United States are rapidly increasing. Yet few researchers have studied immigrants in same-sex couples on a large scale. Using the American Community Survey from 2008 to 2019, this study compares immigrants in same-sex couples to corresponding different-sex couples in order to characterize and assess the scale of LGB migration to the U.S. as well as the role of LGB policy. Compared to different-sex immigrant couples, immigrants in same-sex couples come from richer, more democratic countries that are less represented in immigrant networks. Contrary to previous work focusing on LGB immigrants from repressive contexts, fixed effects models show that these immigrants are more likely to come from LGB-friendly countries. In addition, immigrants in same-sex couples are more likely to live in progressive U.S. states, net of potential confounders. This effect increases in strength as migrants come from more LGB-friendly countries of origin. These findings put into question dominant models of migration that emphasize economic and network effects, suggesting the importance of considering sexuality as well as political and lifestyle motivations more broadly."  
  
keywords: "immigration, same-sex couples, LGBQ policy, sexuality"   

thanks: "The authors contributed equally to this paper."
---

<!-- Turn off hyphenation -->
<!-- \usepackage[none]{hyphenat} -->


```{r setup, include=F}
knitr::opts_chunk$set(echo = F, warning = F, message = F, cache = T, results = 'asis',
                      cache.lazy = F)

library(MASS)
library(janitor)
library(priceR)
library(kableExtra)
library(huxtable)
library(jtools)
library(sjstats)
library(imputeTS)
library(mvtnorm)
library(ordinal)
library(lme4)
library(countrycode)
library(knitr)
library(RColorBrewer)
library(haven)
library(cowplot)
library(srvyr)
library(lmtest)
library(sandwich)
library(here)
library(plm)
library(stargazer)
library(patchwork)
library(tidyverse)

# knitr::opts_chunk$set(error=TRUE) 

options("yaml.eval.expr" = TRUE)

# theme_set(theme_cowplot(font_family = 'Palatino') + 
theme_set(theme_classic(base_family = 'Palatino') + 
            theme(legend.title=element_blank(), 
                  panel.grid.major.y = element_line('grey80'),
                  legend.background = element_rect(fill = "transparent")))
ggplot <- function(...) ggplot2::ggplot(...) + scale_color_brewer(palette="Dark2") +
  scale_fill_brewer(palette="Dark2")

# library(colorspace)
# colorspace_palette = 'RdPu'
# ggplot <- function(...) ggplot2::ggplot(...) +
#   scale_color_discrete_sequential(palette=colorspace_palette) +
#   scale_fill_discrete_sequential(palette=colorspace_palette)

options(scipen=1, digits=2)
knit_hooks$set(inline = function(x) {
  prettyNum(x, big.mark=",")
})
knitr::opts_chunk$set(error=TRUE) 


```

```{r load, include = F}

acs_wide <- read.csv(here('data', 'acs_wide.csv'))
acs_couple_policy <- readRDS(here('data', 'acs_couple_policy.rds')) 
acs_prop_yrimmig_policy <- read.csv(here('data', 'acs_prop_yrimmig_policy.csv')) %>%
  mutate(post_2013 = (yrimmig > 2013))
acs_dyad_policy <- read.csv(here('data', 'acs_dyad_policy.csv'))

# acs_oneimm <- read.csv(here('data', 'acs_oneimm.csv'))
# acs_coupled_imms <- read.csv(here('data', 'acs_coupled_imms.csv'))
# acs_prop_yrimmig <- read.csv(here('data', 'acs_prop_yrimmig.csv'))
# acs_dyad <- read.csv(here('data', 'acs_dyad.csv'))


acs_wide_survey <- acs_wide %>% as_survey_design(ids = cluster, weights = hhwt)
acs_ind_survey <- acs_couple_policy %>% as_survey_design(ids = cluster, weights = perwt)

# Smaller dataset for initial ordered logit analyses
set.seed(1859)
acs_couple_policy_small <- bind_rows(
  filter(acs_couple_policy, same_sex == T, yrimmig >= 1991),
  sample_n(filter(acs_couple_policy, same_sex == F), 1e5)
) 

total_df <- acs_wide_survey %>%
  mutate(same_sex = ifelse(same_sex == T, 'Same-Sex', 'Different-Sex')) %>%
  group_by(year, imm_couple, same_sex) %>%
  summarize(n = survey_total(vartype = "ci")) 
```

```{r intro}
same_2013 <- total_df %>%
  filter(year == 2013, same_sex == 'Same-Sex') %>%
  pull(n) %>% 
  sum()

same_2019 <- total_df %>%
  filter(year == 2019, same_sex == 'Same-Sex') %>%
  pull(n) %>% 
  sum()

dif_2013 <- total_df %>%
  filter(year == 2013, same_sex == 'Different-Sex') %>%
  pull(n) %>% 
  sum()

dif_2019 <- total_df %>%
  filter(year == 2019, same_sex == 'Different-Sex') %>%
  pull(n) %>% 
  sum()
```


# Introduction
In 2013, the U.S. Supreme Court overturned the Defense of Marriage Act and required the U.S. government to begin recognizing marriages between same-sex spouses. Among many consequences, this decision radically changed the immigration landscape: For the first time, same-sex spouses of U.S. citizens and legal permanent residents were eligible to file a spousal petition for an immigrant visa [@edwards_2013]. In the years since, the U.S. population of immigrants in same-sex couples has grown rapidly. While numbers of different-sex couples including immigrants increased by `r round((dif_2019/dif_2013 - 1)*100)` percent from 2013 to 2019 (from `r round(dif_2013 / 1e6,1)` million to `r round(dif_2019 / 1e6,1)` million), those of corresponding same-sex couples grew from `r round(same_2013 /1e3, 1)` thousand to `r round(same_2019 /1e3, 1)` thousand in the same period, an increase of `r round((same_2019/same_2013 - 1)*100)` percent. While descriptions of this burgeoning population exist [@gates_2013; @goldberg_2021], there is a pressing need to understand the forces influencing their migration into the U.S.

The Supreme Court ruling occurred against a backdrop of rapidly changing laws concerning same-sex couples -- and LGB communities, generally -- both in the U.S. and abroad. As some countries expanded rights and social recognition, others imposed new forms of repression [@hadler_2018_world]. These varied dynamics raise an important question: How do changing policy environments influence the migration patterns of individuals in same-sex couples into and across the U.S.? While gender is increasingly recognized as an integral part of the migration process [@lutz_2010; @hondagneu-sotelo_2012], sexuality receives relatively scant attention. Moreover, migration scholarship has only recently begun to factor in the role of social policies not explicitly concerned with migration [@fitzgerald_2014]. Emerging qualitative work has demonstrated, however, that both sexuality and the policies governing it are indeed salient factors influencing migration decisions to the U.S. [@ahmad_2013; @carrillo_2018; @mai_2009; @gorman-murray_2009]. Studying the migration of same-sex couples into and across the U.S. allows us to make broader inferences into how the interaction between sexuality and policy shape migration decisions, underscoring the importance of political and "lifestyle" considerations into understandings of migration [@benson_2012; @fitzgerald_2014].

To address our research question, we evaluate how LGB policies at country-of-origin and U.S. state of residence relate to the migratory patterns for immigrants cohabiting with a same-sex partner. We do so by integrating two types of data. First, we rely on American Community Survey (ACS) data from 2008 to 2019 [@ruggles_2021], which allows the identification of individuals in cohabiting same-sex couples as well as their country of origin, U.S. state of residence, and potentially confounding individual characteristics. Second, we harness original datasets indexing LGB policy changes in 193 countries and all U.S. states from 1991 to 2019 [@velasco_2020]. We merge these two primary data sources with country- and state-level control variables from the UN, World Bank, U.S. government, and other sources.  

Our analytic strategy proceeds in four parts. First, we descriptively understand who these cohabiting LGB immigrants are. This first step is important because little is known about this growing population. Second, we focus on country-of-origin effects, modeling how representation of immigrants in same-sex partnerships changes over time in relation to the LGB policy context of the country of origin. Third, we factor in the role of changing state LGB policy context in models at the U.S. state level. Lastly, we shift our attention to the individual, assessing how being an immigrant in a same-sex couple, net of other individual factors, bears upon choice of LGB policy context by state. We also consider how this relationship is moderated by LGB policy context in the country of origin.  

<!-- Theories of migration often focus on economic and networked dynamics to explain migratory patterns. To the extent social policies are factored into the equation, previous scholarship largely centers policies governing immigration itself. Though understandable, inattention to other social policies obscures how the state can structure migration by conditioning qualities of life that motivates one to leave their country-of-origin. One such important quality of life is sexuality. Indeed, sexuality and how the state governs it is a key motivator for leaving one's home country.   -->

Our investigation finds that origin countries with more LGB-friendly policies send higher proportions of immigrants in same-sex couples into the U.S. In line with the aspirations-capabilities framework [@dehaas_2021], affirming policies enable the migration projects of LGB individuals and provide the necessary material and symbolic resources, whereas oppressive policies hinder such ambitions. This finding is unexpected given that queer migration scholarship to date has largely focused on asylum seekers and how repressive origin-country contexts are critical for granting entry into the U.S. Our findings also indicate that immigrants in same-sex couples are more likely to reside in U.S. states with progressive policies. 
<!-- This is an important intervention as analyses into how sexuality motivates migratory decisions or how migration reimagines sexual behaviors and understandings are limited [@carrillo_2018]. As such,  -->
Findings from this project highlight how the interaction between sexuality and political context shape migration decisions. This research responds to calls to consider factors in both the origin and destination societies when studying migration [@fitzgerald_2008; @luthra_2018] and underscores the importance of incorporating political and "lifestyle" variables into typical understandings of migration [@benson_2012; @fitzgerald_2014]. 


# Background: Changing Policy Landscape for Same-Sex Immigrant Couples

The U.S. has undergone significant shifts in the policies governing LGB populations at both state and federal levels. Since 2003, the U.S. Supreme Court has ruled sodomy laws and the Defense of Marriage Act unconstitutional, recognized same-sex marriages at the federal level, and curtailed employment discrimination. In response, several U.S. states implemented new policies hindering LGB communities on top of existing discriminatory practices like state constitutional bans on marriage equality [@kazyak_2018]. These dynamics create a varied landscape in which state lines significantly demarcate the types of rights and legal environments LGB people experience. Now, a burgeoning area of scholarship exists to understand the causes of these transformations [@lax_2009; @soule_2004] and their distinct consequences on the lives and well-being of LGB people [@boertien_2019; @carpenter_2020; @kail_2015; @levy_2017].  

Although this changing policy landscape affects LGB populations of all types, particular sub-groups within this broad umbrella are differentially impacted. Same-sex immigrant couples represent a population especially vulnerable to recent changes. This is because prior to being able to experience recognized rights like marriage or non-discrimination protections, same-sex immigrant couples must first be able to enter into the U.S. Historically, federal U.S. law hindered same-sex immigrant couples’ ability to enter the country due to the government’s lack of recognition of their relationship [@humanrightswatch_2006]. One of the few mechanisms available to queer migrants for entering the U.S. was through asylum claims -- an invasive process in which migrants needed to “prove” their sexual desires and potential persecution [@humanrightswatch_2006]. These broad legal exclusions often carry over to academic scholarship as well. Analyses of domestic LGB communities often assume citizenship and migration research presents migrants as heterosexual [@luibheid_2008]. The academic research that does acknowledge the realities of queer migrants, though, is largely centered on the asylum claims and offers qualitative insights into how queer migrants navigate this process [@vogler_2016]. As such, there is presently a shallow understanding of the factors broadly influencing the migratory patterns of same-sex immigrant couples beyond this pathway and how these patterns align or diverge from their well-studied heterosexual counterparts. Even broad, descriptive understandings of migrants in same-sex relationships within the U.S. are absent within academic literature. This leaves a significant blindspot.

```{r total-pop, fig.cap = 'Estimated totals of different- and same-sex couples containing one or two immigrants, 2008-2019, with 95% confidence intervals. Vertical line placed at the year 2013, when DOMA was overturned.'}



total_df %>%
  mutate(`Total population (thousands)` = n/1000,
         n_low = n_low/1000, n_upp = n_upp/1000,
         Year = year) %>%
  ggplot(aes(x = Year, y = `Total population (thousands)`, 
             color = imm_couple)) +
  geom_line() +
  geom_ribbon(aes(ymin = n_low, ymax = n_upp, fill = imm_couple, col = NULL), alpha = .2) +
  geom_vline(xintercept = 2013, linetype = 'dashed') +
  facet_wrap(~same_sex, scales = "free") +
  xlim(2007, 2019) +
  theme(legend.justification=c(1,0),
        legend.position=c(.15,.35))

```

The federal environment governing immigration significantly changed after 2013. The U.S. Supreme Court opinion ruling the Defense of Marriage Act (DOMA) unconstitutional opened the door for more same-sex immigrant couples to enter the U.S. under the same process long-governing different-sex couples [@edwards_2013]. Indeed, as Figure \ref{fig:total-pop} highlights, the number of same-sex immigrant couples in the U.S. grew significantly following this ruling -- especially when compared to different-sex couples. Aside from allowing gay and lesbian families to remain unified, this national opening creates an important moment for the scholarly community as well. Now, more careful investigations into the factors both pushing and pulling same-sex immigrant couples into the U.S. can be conducted beyond idiosyncratic asylum claims. The present research fits squarely within this critical research gap.


# Understanding Influences on Migration Patterns
## Conventional Explanations
Our analysis compares conventional explanations for migration to political ones related to LGB policy. Massey et al. [-@massey_1999, p. 50] provided an influential synthesis of migration theories from economics and sociology, arguing that "causal processes relevant to international migration might operate on multiple levels simultaneously." Our investigation incorporates insights from their work as well as assesses how sexuality and LGB policy complicate migration research. At one level, neoclassical economic theories underscore that promise of material gain is a frequent motivation to migrate [@hatton_2005a; @todaro_1980], predicting that migrants will follow wage and unemployment differentials across countries. To account for migration costs, these models often adjust for distance: Immigrants are more likely to migrate between proximate countries, especially those that share a border. At another level, migration streams often continue in a process of cumulative causation even after wage differentials decrease [@massey_1990_social]; this is due in large part to immigrant networks migrants that share information and resources to lower the cost of migration and settling in the destination country [@massey_1987] as well as institutions arise to ease entry and settlement [@hernandez-leon_2013]. Quantitative scholars often measure immigration networks using the relative size of co-national immigrant stock [@beine_2016].  

The theories synthesized by @massey_1999 remained largely materialistic. More recent research adds political and cultural variables to the causal mix. Not only physical but cultural proximity can matter to the migration process; scholars have shown that shared language, colonial history, and democracy matter in the sending country [@karemera_2000; @mayda_2010], and immigrant rights matter in the receiving country [@fitzgerald_2014]. Work on the relationship between welfare policies and immigration suggest that social policies not explicitly related to the latter can impact the migration and settlement processes. Historically, welfare and immigration were tightly linked in the U.S. [@fox_2012], and welfare generosity may play a role in shaping choice of destination for prospective emigrants today [@razin_2015; @ferwerda_2021_pull]. Our research builds on these insights to test how social policy specific to LGB individuals may influence their migration and settlement.  
 
<!-- Previous scholarship has not explicitly applied these analyses and insights to the migration of same-sex couples on a large scale in the U.S. context, but previous demographic research on non-immigrant same-sex couples suggests characteristics salient to the migration process may still relate to their migration. In the labor market, men in same-sex couples tend to earn less than their heterosexual counterparts, but women tend to earn more [@klawitter_2015], although the gap for the latter has decreased in recent years [@badgett_2021_lgbtq]. On average, married same-sex couples are older and have higher earnings than their different-sex counterparts [@fisher_2018], while results for unmarried couples are mixed [@baumle_2009; @badgett_2021_lgbtq]. If immigrants in same-sex couples have higher earnings than heterosexual immigrants, then the typical economic push and pull factors of immigration may affect them differently. As discussed below, one difference is that these higher earnings may open pathways for lifestyle factors to influence their migration decisions [@benson_2009; @dixon_2020]. Same-sex couples also tend to be less homogamous in age, education, and race/ethnicity than their different-sex counterparts [@schwartz_2009].   -->

<!-- Finally, although male same-sex romantic relationships generally have higher levels of instability than female or different-sex relationships [@joyner_2017], the dissolution rates for cohabiting same- and different-sex couples are similar [@manning_2016]. If LGB immigrants experience higher rates of union dissolution, then our estimates of the proportion of immigrants who are in same-sex couples represents a lower bound.   -->

Sexuality may interact with processes of migration in ways not anticipated by the migration theories synthesized by @massey_1999 or recent work on political and cultural factors. Whereas @massey_1999 sought to integrate migration theories at different causal levels, more recent sociological work seeks to uncover heterogeneity between different types of migrants [@garip_2012; @drouhot_2021_what]. @garip_2016 argues that different theories of migration are more relevant for different types of migrants; as the most prevalent migrant types shift, theories arise to better explain them. Our study builds on this work by probing migrant heterogeneity, assessing what the theories of migration synthesized by @massey_1999 might miss when accounting for the migration of this LGB subpopulation. We also seek to intervene within migration scholarship by explicitly considering how sexuality, and the governance of it, expand our comprehension of migration atop this previous work.

<!-- structural explanations point to how the disruption of local economies by global forces spurs out-migration [@piore_1979; @wallerstein_1979]. Network theory explains for why migration streams often continue to flow in full force even after wage differentials decrease [@massey_1987], while work on the "migration industry" shows how brokers, recruiters, smugglers, and other "entrepreneurs" initiate and maintain migrant flows [@hernandez-leon_2013]. However, there is little reason to believe that the economic, structural, network, and institutional forces that shape migration of heterosexual immigrants differ from those that affect LGB immigrants. These theories fall short of explaining the rapid rise of immigrants in same-sex couples in the U.S.  -->

<!-- The problem lies in two conspicuous absences in mainstream migration theory. The first is the lack of a large role for the state. Outside of violent contexts triggering refugee flows [@fitzgerald_2018], scholars of migration rarely focus on the political factors that both constrain and enable migration in sending and receiving countries. In recent years, some research has emerged that does consider political variables explicitly. For example, on the receiving country side, @fitzgerald_2014 show that safeguards for immigrant rights are important predictors of immigration, even in models that control for the usual economic, distance, and network variables in a "gravity model." Other scholars have looked at sending-country policies relevant to emigration, such as dual citizenship laws [@leblang_2017] and autocratic restraints on exit [@miller_2018]. State policy relevant to particular subgroups or not obviously related to migration, however, has received little study.   -->

<!-- Second, the dominant migration literature rarely considers how identity might shape migration desires. Recent research in "lifestyle migration" [@benson_2012] begins to probe the non-economic hopes and aspirations that might encourage settling in a new country. And although gender is slowly being recognized as an integral consideration in studies of migration [@lutz_2010; @hondagneu-sotelo_2012], sexuality has received comparably little attention. Moving beyond the dominant migration theories synthesized by Massey et al. [-@massey_1999], this paper sheds light on how the intersection of state policy and sexuality shapes migration decisions.  -->

<!-- As immigrants in same-sex couples become more prevalent in the U.S., new theory is needed to explain -->



<!-- Micro- and macroeconomic theories underscore that promise of material gain is a frequent motivation to migrate [@hatton_2005a]. Yet migration decisions rarely occur at the individual level; proponents of the so-called New Economics of Labor Migration (NELM) argue that the migration decision is a family affair devised to mitigate risk and diversify income streams [@stark_1985]. Another influential explanation for why migration streams often continue to flow in full force even after wage differentials decrease lies in network theory; migrants share information and resources to lower the cost of migration and settling in the destination country [@massey_1987]. World Systems Theory    -->

<!-- These three theories have proven hugely influential in migration studies.  -->

## Our Intervention
We integrate functionalist theories of migration with an aspirations-capabilities framework [@dehaas_2021; @schewel_2020; @carling_2018_aspiration]. De Haas [-@dehaas_2021, p. 17] defines migration as “a function of aspirations and capabilities to migrate within given sets of *perceived* geographical opportunity structures” (emphasis added). This framework blends individual, agentic motivations for migration (e.g., subjective desires and imaginations of well-being) with structural factors that condition these aspirations and the capabilities to act upon them (e.g., culture and policy). Thus, we use this framework to situation our intervention: to demonstrate why sexuality, and the state’s governance of it, meaningfully contributes toward understandings of migration [@carrillo_2018; @cantu_2009; @suen_2021_sexual].  

The state plays an important role setting structural conditions that influence migratory pathways. One direct route is by establishing law governing migration itself. Indeed, significant scholarship details how such laws and policies are used to target distinct populations -- whether based on labor market needs, assistance following local disaster, or familial ties. However, @dehaas_2021 offers a more expansive view of the state. They contend that the state influences migration through policy that influence individual’s life aspirations and well-being -- whether real or imaged -- and by conditioning the capacity to migrate based on negative and positive “liberties,” or freedoms. For example, explicit migration policy represents a “negative liberty,” whereby the state externally imposes opportunities and constraints, but liberal telecommunications policy that allows for the transnational flow of news, media, and information is a “positive liberty” that influences the capacity to migrate -- in this case by increasing knowledge of alternatives and the “capacity to aspire” [@dehaas_2021]. Therefore, the aspirations-capabilities framework is not a rejection of previous theories of migration, but a more expansive framework that acknowledges the subjective role of individuals to determine if migration advances their well-being within given conditions.

Sexuality, and the state’s governance of it, squarely fits within this framework as sexuality is a salient quality of well-being and, as demonstrated by the DOMA decision in the U.S., conditions the capacity to migrate. Moreover, recent global expansions of LGB rights allows us to leverage varied policy landscapes and investigate beyond migration-oriented policy to theorize the role of the state within these processes [@fitzgerald_2014].

Sexuality has long factored into migratory decisions. However, as the global awareness of LGB rights expands, sexuality is increasingly an important factor when deciding to leave one’s home country [@mole_2018a; @murray_2016]. This is partly due to international organizations’ construction of sexuality as a legitimate basis for leaving. For example, in 2008 the United Nations High Commissioner for Refugees issued a new guidance note for why and how countries should consider sexual orientation and gender identity when granting asylum claims. The note states:  

>[I]ndividuals experience serious human rights abuses and other forms of persecution due to their actual or perceived sexual orientation and/or gender identity. While persecution of Lesbian, Gay, Bisexual, Transgender and Intersex (hereafter “LGBTI”) individuals and those perceived to be LGBTI is not a new phenomenon, there is greater awareness in many countries of asylum that people fleeing persecution for reasons of their sexual orientation and/or gender identity can qualify as refugees [...]. [@unhcr_2008, p. 2]

The note continues to guide various authorities to consider discriminatory domestic policies when evaluating asylum claims as such policies “can create or contribute to an oppressive atmosphere of intolerance and generate a threat of prosecution” [@unhcr_2008, p. 8]. International organizations like the European Union and several countries now incorporate this guidance [@giametta_2020].  

Therefore, the globalization of LGB rights, and the transnational flow of information, cultural content, general visibility, and changing policy environments that accompany it [@ayoub_2016; @ayoub_2017], are likely to influence the migration of LGB communities by changing aspirations and capabilities to migrate. Current research on the types of policy environments likely to influence the migration of those in same-sex couples, however, is both limited in scope and mixed in outcomes. Although family-related migration has long overshadowed work-related among permanent migrants to the U.S. [@kandel_2018_familybased], theorization on family migration has largely ignored same-sex couples [e.g. @kofman_2004_family]. Additionally, emerging scholarship at the intersection of sexuality and migration is overwhelmingly qualitative. Though this provides rich insights into the motivations and consequences of migration, differing effects of policies emerge. Research on queer asylum, one key line of research within this area, suggests repressive policies are more likely to spur migration to the U.S. However, another set of scholarship, extending from research on "lifestyle migration," suggests affirming policy environments may serve as a migratory launchpad. Thus a broader portrait for how policy environments influence queer migration is urgently needed.  

Prior to our theorization, we first clarify the composition of our target population. The key axis of differentiation we are interested in is immigrants in same-sex couples relative to immigrants in different-sex couples within the U.S. Thus, our target population consists of: 1) two-immigrant couples who came to the U.S. together; 2) two-immigrant couples that formed once in the U.S.; 3) mixed status couples where an immigrant came to be with their U.S. partner; and 4) mixed status couples that formed in the U.S. We theorize general mechanisms that influence all composition types but, below, acknowledge the potential or differential effects depending on couple composition. We elaborate on the implications of these scope conditions in the Discussion.

To begin, one set of literature suggests that migrants in same-sex relationships are largely escaping repressive contexts. Queer migration research typically focuses on those coming to the U.S. under these conditions. Part of this overemphasis is because of the U.S. policy environment which, for so long, did not define same-sex couples as “family.” Consequently, this left asylum as one of the few viable mechanisms for entry and dramatically limited the capacity to migrate into the U.S. [@luibheid_2008; @vogler_2016]. Though the U.S. is certainly less progressive and inviting compared to many other Western states, high-profile developments like marriage equality can contribute to an imagined openness relative to many locations around the world. Indeed, access to gay content in film and on the Internet contributed toward Iranian refugees to seek sexual freedom in the West. These asylum seekers assumed, or aspired to live in, more affirming environments and knew such countries allowed sexual orientation as a basis for asylum [@karimi_2020]. Additionally, another strand of research documents people in more oppressive contexts seeking out partners in more equitable locations who can then sponsor them through the immigration process [@carrillo_2018; @corey-boulet_2019]. Consequently, as Adur [-@adur_2018, p. 321, emphasis theirs] summarizes, “sexuality also shapes migration as LGBTI immigrants relocate in pursuit of spaces that they *imagine* will be safer and more liberal.” Though such studies suggest immigrants same-sex couples are largely fleeing repressive contexts, to what extent is this representative of immigrants in same-sex couples, generally? 

Alternatively, immigrants in same-sex couples may come from countries with greater recognition and access to sexuality-related rights and services. There are two interrelated reasons for this. First, affirming policy environments are likely to enable people’s capacity to make such an important, and expensive, move. Long-standing research on immigrant selection demonstrates that migrants are typically from stronger social positions -- more formal education, higher incomes, and more prestigious occupations [@feliciano_2020]. Given the high barriers to migrating, supportive policies like access to full marriage equality and protections against employment discrimination may enable the capacity to migrate by providing the necessary social, human, and economic capitals. Second, same-sex coupledom, like marriage, is a culturally contingent artifact [@philpot_2016_gay]. Consequently, the interactive dynamics between policy and culture within an immigrant’s country-of-origin is likely to influence their desire to be part of a couple to begin with [@baiocco_2014_desire; @flores_2016_backlash; @ocobock_2020_leveraging; @suen_2021_sexual]. Policies supportive of LGB communities normalize and validate such identities and partnerships [@ocobock_2020_leveraging] -- influencing those with same-sex attractions to imagine and aspire such possibilities for themselves. And, relatedly, being from a country where the state recognizes one’s sexuality and validates these relationships may make survey respondents, once in the U.S., more comfortable disclosing such relationships. As such, immigrants from countries without this cultural and political background may be more reticent to desire or disclose same-sex partnership. 

Indeed, these arguments follow from scholarship on lifestyle migration -- which de Haas integrates with the aspirations-capabilities framework. Benson and O'Reilly [-@benson_2009, p. 608] refer to lifestyle migration as the "relocation of relatively affluent people within the developed world searching for a better way of life."  Typically, lifestyle migration is conceptualized as a highly individualized decision-making process as conceptualizations of "better way of life" differ drastically [@benson_2016]. However, supportive LGB policies may offer a structural opening by which same-sex couples have the opportunity and bandwidth to consider these individualistic choices. Of course, as mentioned, there is little previous research on how same-sex immigrant couples fare socioeconomically. However, if these migrants mimic their U.S.-based counterparts, their better standing will likely enable lifestyle migration processes.

While these country-of-origin policies may influence the “push” of same-sex couples out of their home country, the varied policy environments across U.S. states are likely to differentially “pull” these couples. Though research often focuses on either country-of-origin or the destination, part of our intervention is to study these in tandem to provide a more comprehensive understanding of migration. Indeed, especially coming from an aspirations-capabilities framework where subjective perceptions are meaningful, this dual investigation is necessary to understand relative contrasts.  

Typically, a strong predictor of where migrants locate within the U.S. are network effects -- they locate where the people they know are located [@massey_1987; @portes_1998; @palloni_2001]. Existing research highlights that gay and lesbian couples within the U.S. were likely to leave states without marriage equality prior to national recognition [@beaudin_2017]. This likely results in a greater concentration of same-sex couples in states with marriage equality and other protective policies and increasing the chances that same-sex immigrant couples know someone in those states as well -- seeing as queer migrants often have strong cross-national networks for relaying information [@stella_2020]. Additionally, if migrants are coming from a country with greater legal protections, they are unlikely to want to relocate to a state where such rights are no longer recognized -- making the political environment acutely important. Of course, this is predicated on the assumption that migrants take such distinct sub-national variations into account -- which they very well may not. Consequently, the "pull" to individual states may operate independently from specific state laws affirming LGB people and their relationships.  

Though limited, existing demographic research does give some insights into how immigrants in same-sex couples might choose their state of residence once in the U.S. Cohabiting same-sex couples already within the U.S. are more likely to reside in states in the Northeast and West, such as Vermont, Massachusetts, California, and Oregon [@gates_2013a], that have often been at the forefront in safeguarding LGB rights. The same-sex population is growing most rapidly, however, in the Midwest and South (*ibid.*). Regardless of state, same-sex couples are more concentrated in urban areas, although this is truer for men than women [@baumle_2009]. This evidence suggests that immigrants in same-sex couples are likely to choose progressive states and cities as their place of residence.  

In sum, it is evident that sexuality, and the policies governing it, are salient factors driving migratory decisions -- either enabling same-sex couples the opportunity and flexibility to make decisions that are best for them or by erecting such a repressive environment that it forces migrants to flee to where imagination of opportunity awaits. Aside from qualitative examinations into queer migrants, especially asylum seekers, there is no large-$N$ investigation into how the significant transformation of LGB policies -- both globally and across U.S. states -- influence migration patterns in the U.S. or their descriptive attributes. Therefore, this research seeks to correct this gap within the literature by providing such an analysis and to further understand how the changing policy landscapes are differentially influencing the lives of queer people depending on their social positions.


<!-- Prior to getting to the data and results of this analysis, it is first important to contextualize the present article within existing demographic scholarship.  -->


<!-- Note from Kris: I'm wondering if we should actually incorporate the "labor market" paragraph into the "Conventional Explanations" section? Put in there why we think conventional explanations apply/differ to same-sex couples? And then,the first paragraph could kinda go into theorizing why state policies may matter for same-sex couples but not different sex? -->

# Data
## Identifying Same-Sex Couples in the ACS
We merge individual-level data on immigrants in the U.S. with state- and country-level variables from a variety of datasets. The individual data come from the 2008 to 2019 ACS [@ruggles_2021]. Each year, the ACS surveys a 1-percent representative sample of the U.S. population about their education, occupation, income, family structure, immigration status, country of origin, location, and a variety of other individual and household attributes. We define a same-sex couple as two individuals of the same sex in the same household who report their relationship as "spouse" or "unmarried partner." We limit the sample to individuals who immigrated at the age of 18 or older and in 1991 or later.^[The exception is for for Figure \ref{fig:total-pop}, where we include those who immigrated in any year, at age 18 or older.] The 12 years of survey data contain `r nrow(filter(acs_wide, same_sex == T & (yrimmig_main >= 1991 | yrimmig_partner >= 1991)))` same-sex couples that include at least one immigrant, for a total of `r nrow(filter(acs_couple_policy, same_sex == T))` immigrants in same-sex couples with complete data. These immigrants are compared to `r nrow(filter (acs_wide, same_sex == F & (yrimmig_main >= 1991 | yrimmig_partner >= 1991)))` corresponding different-sex couples containing `r nrow(filter(acs_couple_policy, same_sex == F))` individual immigrants. Below, we outline how we use these data to construct dependent variables based on each analysis. All analyses incorporate ACS sampling weights.  

Measuring the prevalence of same-sex couples in the U.S. is difficult [@michaels_2013]. As in most nationally representative demographic work on same-sex couples [@baumle_2013; @baumle_2019], we are able to identify only LGB couples that cohabit; unpartnered LGB individuals and those who do not live with their partner are not included in the analysis [@baumle_2009, p. 6]. In addition, LGB individuals who do not feel comfortable with the partner labels of the ACS are not in the sample. Another pitfall is measurement error: misreporting may result when different-sex couples accidentally misspecify the gender of one of the partners [@gates_2009; @goodnature_2021]; beginning in 2008 the Census Bureau made changes to ACS gender and partnership questions in order to prevent such errors [@u.s.censusbureau_2013], so we rely on data only from 2008 onward, but difficulties remain. If even a small number of different-sex couples misreport one partner's sex, the counts of same-sex couples will be inflated. Following @gates_2009, we remove all respondents that had either their relationship or sex variable allocated by the Census Bureau, which results in dropping `r 7683 - sum(acs_couple_policy$same_sex == T)` immigrants in same-sex couples and `r 949775 - sum(acs_couple_policy$same_sex == F)` in different-sex couples, or `r round(1-nrow(acs_couple_policy) / 957458, 4) * 100` percent of the sample. This is the strategy used by most studies of same-sex couples in the ACS [e.g. @boertien_2019; @gates_2013; @goldberg_2021; @christafore_2019; @martell_2020]. We also include robustness checks to test the sensitivity of our results to high rates of misreporting.


## Explanatory Variables
Our explanatory variables of interest are the LGB policy contexts in country of origin and U.S. state of residence. To create the U.S. state policy index, we compile data from the Movement Advancement Project, a leading LGB organization in the U.S. that collects data on a number of relevant policies. Our state index encompasses both progressive policies (full marriage equality, state recognition of civil unions and domestic partnerships, ban on all employment and housing discrimination based on sexual orientation, hate crime protections based on sexual orientation, legal joint adoption by same-sex couples, and a ban on conversation therapy for minors) and regressive policies (criminalization of sodomy, state constitutional bans of marriage equality, religious freedom exemptions to discriminate against same-sex couples in adoption, and state-level bans on local non-discrimination ordinances encompassing sexual orientation). The state index ranges from `r min(acs_couple_policy$state_policy, na.rm = T)` to `r max(acs_couple_policy$state_policy, na.rm = T)`, and the mean score of country of origin for immigrants in our sample is `r mean(acs_couple_policy$state_policy, na.rm = T)`.

We measure the origin country policy environment using a modified LGBT Policy Index [@velasco_2018]. The index comprises 16 policies, many similar to those above, but including additional policies like the death penalty for homosexual acts, propaganda laws limiting free speech for LGB communities, and equal age of consent between same-sex and different-sex couples. We remove policies targeting gender identity and transgender communities from the original index. Both state and country indices are created by summing the net total of progressive policies (scored $+1$) over regressive policies (scored $-1$). The country index ranges from `r min(acs_couple_policy$origin_score, na.rm = T)` to `r max(acs_couple_policy$origin_score, na.rm = T)`, and the mean score of country of origin for immigrants in our sample is `r mean(acs_couple_policy$origin_score, na.rm = T)`.
Immigrants are assigned U.S. state index scores based on their state of residence as reported in the ACS. They are assigned country-of-origin index scores based on their birthplace and year of immigration.  

Aside from the country and state indices, we also include a binary variable to indicate the change in national policy environment within the U.S. following the overturning of DOMA. This represents an important shift opening up traditional pathways of immigration to same-sex couples. We also include an interaction term between this post-DOMA indicator and country-of-origin index because we theorize that the effects will be more pronounced following this period.


## Control Variables
Our country- and state-level controls come from a variety of sources. Country-of-origin controls for bilateral distance, contiguous border, common official language, common ethnic language, and whether the country was a former colony of the U.S., come from CEPII's GeoDist dataset [@mayer_2011]. Difference in living standards, calculated as difference in per capita GDP at purchasing power parity (U.S. minus country of origin), come from the RGDP$^\text{e}$ variable of the Penn World Table [@feenstra_2015], and we rely on World Bank data for differences in unemployment rates [@worldbank_2020]. We use Varieties of Democracy (V-Dem) measures of liberal democracy of the country of origin [@coppedge_2021]. We proxy network effects by dividing each country's immigrant stock by the total number of immigrants in the U.S. in a given year, using the UN's Trends in International Migrant Stock report for [@unitednations_2017] for 1990, 1995, 2000, 2005, 2010, 2015, and 2017, linearly interpolating to yield an annual time series from 1990 to 2020. For state controls, we use per capita income by year from the Bureau of Economic Analysis [@bea_2020] and state-level annual unemployment rates from the Bureau of Labor Statistics [@bls_2020]. All monetary variables are adjusted to 1999 U.S. dollars.  

<!-- We use Polity5 measures of democracy of the country of origin [@marshall_2018], with linear interpolation for missing years.  -->

<!-- the World Bank's Global Bilateral Migration Database [@ozden_2011] for 1960, 1970, and 1980 and -->

For our individual-level analysis we include individual controls from the ACS for reported sex, age, education (with categories for less than high school, high school, some college, and college), year of immigration, inverse hyperbolic sign of positive income in the past year [similar to the natural log transformation; see @burbidge_1988_alternative], and a binary unemployment indicator (for income reported to be 0 or less). Descriptive statistics of variables used in all analyses are included in the Suppelementary Material. 



# Analytic Strategy
Our first goal is to isolate the effects of country-of-origin LGB policy on the immigration of immigrants in same-sex couples. The ideal survey would follow potential immigrants over time and have information about sexual orientation, allowing us to estimate how the probability of migrating and choice of U.S. state of residence vary by sexual orientation. This ideal dataset does not exist, but we approximate it at the macro level. We take the number of immigrants in same-sex couples from a given country and a given year of immigration and divide by the total number of immigrants from that country-year. We then multiply by 100 to yield a percentage. In effect this controls for aspects of the migration process common to all immigrants from a given country; if sending-country LGB policy has no effect on migration rates of LGB immigrants, then we would expect these proportions to be similar across countries. However, even if proportions of immigrants in same-sex couples vary between countries, LGB policy may not be the cause; perhaps LGB immigrants respond idiosyncratically to gravity-model variables that may covary with LGB policy, such as country income, unemployment, democratization, relationship to the U.S., and immigrant networks, so we control for these variables in our preferred model and estimate using ordinary least squares (OLS) regression. Our preferred model also includes country fixed effects to account for unobserved heterogeneity within countries. All of these models use country-clustered standard errors. To assess the influence of the 2013 Supreme Court decision on DOMA, we also add a dichotomous variable for whether the year of immigration was later than 2013, and we interact this variable with sending-country policy score.  

Our next set of models address how differing LGB policy environments across U.S. states influence proportions of immigrants in same-sex couples. We reshape the data so that each observation is the proportion of individual immigrants in same-sex couples from country $x$ in state $y$ in year $z$, then multiply by 100. As in the previous set of models, this reshaping acts to control for aspects of migrant settlement common to immigrants from the same country. We merge this by survey year to state-level measures of LGB policy, per capita income, unemployment rate, and we merge with origin-country LGB policy and the same country-level controls as in the previous models using the mean year of immigration for each immigrant group.  We regress the state-country-survey year proportion on state and sending-country policy scores, including state and origin-country controls. We include state and country-of-origin fixed effects, and we cluster errors at the state and country levels.    

Our final set of models turns toward the individual: Conditional on immigrating to the U.S., do immigrants in same-sex couples choose more LGB-friendly states to reside in? And how does sending-country LGB context moderate this relationship? This part of the analysis uses ordered logistic regression to predict the policy index of state of residence. Whereas the full U.S. state policy index ranges from `r min(acs_couple_policy$state_policy, na.rm = T)` to `r max(acs_couple_policy$state_policy, na.rm = T)`, we break up the index into three "bins": repressive (0 or less), neutral (1 or 2), and progressive (3 or greater). We regress this ordered categorical outcome on a same-sex indicator and country-of-origin policy score, interacting these variables in our preferred model. The interaction term estimates the possibly moderating effect of origin-country policy context. We also control for individual attributes that could possibly confound our results, interacting these with the same-sex indicator, and we include country- and state-clustered standard errors. The final model also includes state and country controls.^[For computational reasons, in the working version of this paper we randomly select 100,000 different-sex couples from the full dataset for the individual analysis.]


# Results
## Descriptive Trends
We first estimate total numbers of immigrants in same- and different-sex couples, applying survey weights to obtain population-level estimates from the ACS. Recall, Figure \ref{fig:total-pop} showed that whereas numbers of different-sex immigrant couples have steadily increased over the period of study, numbers of same-sex immigrant couples have increased much more rapidly, especially since the the 2013 Supreme Court decision overturning DOMA.  

```{r desc, fig.cap = 'Descriptive statistics for immigrants in couples 2008-2019, with survey weights and 95% confidence intervals. All currency in thousands of 1999 dollars.'}
income <- acs_ind_survey %>%
  mutate(same_sex = ifelse(same_sex == T, 'Same-Sex', 'Different-Sex')) %>%
  group_by(year, same_sex) %>%
  summarize(var = survey_mean(inctot, vartype = "ci", na.rm = T)) %>%
  mutate(var_name = 'Individual Income')

# hwsei <- acs_ind_survey %>%
#   mutate(same_sex = ifelse(same_sex == T, 'Same-Sex', 'Different-Sex')) %>%
#   group_by(year, same_sex) %>%
#   summarize(var = survey_mean(hwsei, vartype = "ci", na.rm = T)) %>%
#   mutate(var_name = 'Hauser and Warren Socioeconomic Index')
# 
# nchild <- acs_ind_survey %>%
#   mutate(same_sex = ifelse(same_sex == T, 'Same-Sex', 'Different-Sex')) %>%
#   group_by(year, same_sex) %>%
#   summarize(var = survey_mean(nchild, vartype = "ci", na.rm = T)) %>%
#   mutate(var_name = 'Number of Children')
# 
# years <- acs_ind_survey %>%
#   mutate(same_sex = ifelse(same_sex == T, 'Same-Sex', 'Different-Sex')) %>%
#   group_by(year, same_sex) %>%
#   summarize(var = survey_mean(years_in_us, vartype = "ci", na.rm = T)) %>%
#   mutate(var_name = 'Years in U.S.')

# distance <- acs_ind_survey %>%
#   mutate(same_sex = ifelse(same_sex == T, 'Same-Sex', 'Different-Sex')) %>%
#   group_by(year, same_sex) %>%
#   summarize(var = survey_mean(distw, vartype = "ci", na.rm = T)) %>%
#   mutate(var_name = 'Distance to Country of Origin (KM)')
# 
# unemp <- acs_ind_survey %>%
#   mutate(same_sex = ifelse(same_sex == T, 'Same-Sex', 'Different-Sex')) %>%
#   group_by(year, same_sex) %>%
#   summarize(var = survey_mean(unemp_dif, vartype = "ci", na.rm = T)) %>%
#   mutate(var_name = 'Difference in Unemployment Rates')

prop_stock <- acs_ind_survey %>%
  mutate(same_sex = ifelse(same_sex == T, 'Same-Sex', 'Different-Sex')) %>%
  group_by(year, same_sex) %>%
  summarize(var = survey_mean(stock_prop, vartype = "ci", na.rm = T)) %>%
  mutate(var_name = 'Proportion Immigrant Stock in Year of Migration')

wage_dif <- acs_ind_survey %>%
  mutate(same_sex = ifelse(same_sex == T, 'Same-Sex', 'Different-Sex')) %>%
  group_by(year, same_sex) %>%
  summarize(var = survey_mean(wage_dif, vartype = "ci", na.rm = T)) %>%
  mutate(var_name = 'Bilateral Per-Capita GDP Differential in Year of Migration')

vdem <- acs_ind_survey %>%
  mutate(same_sex = ifelse(same_sex == T, 'Same-Sex', 'Different-Sex')) %>%
  group_by(year, same_sex) %>%
  summarize(var = survey_mean(vdem, vartype = "ci", na.rm = T)) %>%
  mutate(var_name = 'V-Dem Score in Year of Migration')

# state_income <- acs_ind_survey %>%
#   mutate(same_sex = ifelse(same_sex == T, 'Same-Sex', 'Different-Sex')) %>%
#   group_by(year, same_sex) %>%
#   summarize(var = survey_mean(state_income, vartype = "ci", na.rm = T)) %>%
#   mutate(var_name = 'U.S. State of Residence Per Capita Income')



bind_rows(income, wage_dif, vdem, prop_stock) %>%
  rename(Year = year) %>%
  ggplot(aes(x = Year, y = var, color = same_sex)) +
  geom_line() +
  geom_ribbon(aes(ymin = var_low, ymax = var_upp, fill = same_sex, col = NULL), alpha = .2) +
  facet_wrap(~var_name, scales = "free") +
  ylab('') +
  theme(legend.justification=c(1,0),
      legend.position=c(.22,.82),
      legend.background = element_rect(fill = alpha("white", 0.5)))
 
```

How do same- and different-sex immigrant couples differ in their individual attributes? Do variables typically used in models for migration differ between the groups? Figure \ref{fig:desc} compares immigrants in same- and different-sex couples on four variables. First, macroeconomic theory predicts that difference in wages and living standards across countries is one of the most important motivations for migration. The first panel in Figure \ref{fig:desc} shows that the per-capita GDP differential is indeed positive for both groups of immigrants, but it is significantly more positive for immigrants in different-sex couples. This means that immigrants in same-sex couples are coming from countries with higher standards of living than those in different-sex couples.  

Statistics for the unemployment rate differential (see Supplementary Material) indicate similar trends: LGB immigrants come from countries with lower unemployment rates. These findings indicate that macroeconomic considerations may be less important to the migration of LGB immigrants. The second panel corroborates this finding on the individual level: Not only do immigrants in same-sex couples come from countries with higher per capita GDP, but they individually tend to earn more than immigrants in different-sex couples. Additional analyses (see Supplementary Material) demonstrate that immigrants in same-sex couples also tend to work in professions with higher occupational prestige scores and have somewhat higher education qualifications, indicating that they may come from more privileged social origins than their heterosexual counterparts.  

The bottom-left panel of Figure \ref{fig:desc} looks at a measure of network effects: at the time of immigration, what is the proportion of total immigrants in the U.S. from the country of origin? Compared to different-sex couples, immigrants in same-sex couples immigrated from countries that were less represented in the U.S. population at the time of migration. This indicates that the network effects that attract migrants from the same country of origin may be less relevant to LGB immigrants. Finally, the fourth panel of Figure \ref{fig:desc} compares V-Dem democracy level for country of origin at time of migration. We see that levels of democracy tend to be higher for immigrants in same-sex couples, indicating that political context may play a more important or different role in their migration decisions.  

Although we see significant differences between same- and different-sex couples on a number of important migration variables, none shows the sudden jump in recent years reflected in Figure \ref{fig:total-pop}. Turning to LGB policy may better explain this surge. Figure \ref{fig:policy-desc} charts the average country-of-origin and U.S.-state LGB policy score for the immigrants in our sample over time, comparing means for immigrants in same- and different-sex couples. The left panel shows that country-of-origin index at time of migration is generally higher for immigrants in same-sex couples, and since 2013 it has rapidly increased. Immigrants in same-sex couples tend to come from more progressive countries, and this trend tracks closely with the overall population of this group. The right panel indicates less of a difference in U.S. state policies, although states where immigrants in same-sex couples live tend to score somewhat higher. 

```{r policy-desc, fig.cap = 'Mean country-of-origin and U.S. state policy index score for immigrants in same- and different-sex couples, 2008-2019, with 95% confidence intervals.'}


origin_df <- acs_ind_survey %>%
  mutate(same_sex = ifelse(same_sex == T, 'Same-Sex', 'Different-Sex')) %>%
  group_by(year, same_sex) %>%
  summarize(`Policy Score` = survey_mean(origin_score, vartype = "ci", na.rm = T)) %>%
  mutate(var = 'Country-of-Origin Index')

state_df <- acs_ind_survey %>%
  mutate(same_sex = ifelse(same_sex == T, 'Same-Sex', 'Different-Sex')) %>%
  group_by(year, same_sex) %>%
  summarize(`Policy Score` = survey_mean(state_policy, vartype = "ci", na.rm = T)) %>%
  mutate(var = 'U.S. State Index')

bind_rows(origin_df, state_df) %>%
  rename(Year = year) %>%
  ggplot(aes(x = Year, y = `Policy Score`, 
             color = same_sex)) +
  geom_line() +
  geom_ribbon(aes(ymin = `Policy Score_low`, ymax = `Policy Score_upp`, 
                  fill = same_sex, col = NULL), alpha = .2) +
  facet_wrap(~var, scales = "free") +
  theme(legend.justification=c(1,0),
        legend.position=c(.25,.65))
```



```{r country-tab}
country_tab <- acs_couple_policy %>%
  group_by(bpld, same_sex) %>%
  count(wt = perwt) %>%
  pivot_wider(names_from = 'same_sex', values_from = 'n') %>%
  mutate(prop_samesex = round(100*`TRUE` / `FALSE`, 2)) %>%
  arrange(desc(prop_samesex)) %>%
  .[1:10,] %>%
  mutate(prop_samesex = case_when(
    nchar(prop_samesex) == 4 ~ paste0(prop_samesex, ' %'),
    nchar(prop_samesex) == 3 ~ paste0(prop_samesex, '0 %'),
    nchar(prop_samesex) == 1 ~ paste0(prop_samesex, '.00 %'))) %>%
  rownames_to_column() %>%
  left_join(acs_couple_policy %>%
              group_by(bpld) %>%
              summarize(`Mean policy score` = 
                          weighted.mean(origin_score, na.rm = T, w = perwt))) %>%
  select(Rank = rowname, `Country of origin` = bpld, `Proportion same-sex` = prop_samesex,
         `Mean policy score`)

country_tab %>%
  kable(booktabs = T, 
        linesep = '',
        caption = 'Sending countries ranked by proportion immigrant couples with same-sex partners') %>%
      footnote(general = "American Community Survey 2008-2019. Authors\' calculations.",
           general_title = 'Source:',
           footnote_as_chunk = T) 


country_vec <- country_tab$`Mean policy score`
names(country_vec) <- country_tab$`Country of origin`


# acs_couple_policy %>%
#   filter(year == 2008) %>%
#   group_by(bpld, same_sex) %>%
#   count(wt = perwt) %>%
#   pivot_wider(names_from = 'same_sex', values_from = 'n') %>%
#   arrange(desc(`TRUE`)) %>%
#   .[1:10,] %>%
#   rownames_to_column() %>%
#   left_join(acs_couple_policy %>%
#               filter(year == 2008) %>%
#               group_by(bpld) %>%
#               summarize(origin_score = mean(origin_score)) %>%
#               select(bpld , origin_score))

```

```{r state-tab}
state_tab <- acs_wide %>%
  filter(state != 'District of Columbia') %>%
  group_by(state, same_sex) %>%
  count(wt = hhwt) %>%
  pivot_wider(names_from = 'same_sex', values_from = 'n') %>%
  mutate(prop_samesex = round(100*`TRUE` / `FALSE`, 2)) %>%
  arrange(desc(prop_samesex)) %>%
  .[1:10,] %>%
  mutate(prop_samesex = case_when(
    nchar(prop_samesex) == 4 ~ paste0(prop_samesex, ' %'),
    nchar(prop_samesex) == 3 ~ paste0(prop_samesex, '0 %'),
    nchar(prop_samesex) == 1 ~ paste0(prop_samesex, '.00 %'))) %>%
  left_join(acs_couple_policy %>%
              group_by(state) %>%
              summarize(`Mean policy score` = 
                          weighted.mean(state_policy, na.rm = T, w = perwt))) %>%
  rownames_to_column() %>%
  select(Rank = rowname, `State` = state, `Proportion same-sex` = prop_samesex,
         `Mean policy score`)

state_tab %>%
  kable(booktabs = T, 
        linesep = '',
        caption = 'States ranked by proportion immigrant couples with same-sex partners') %>%
      footnote(general = "American Community Survey 2008-2019. Authors\' calculations.",
           general_title = 'Source:',
           footnote_as_chunk = T) 

state_vec <- state_tab$`Mean policy score`
names(state_vec) <- state_tab$`State`
```

Table \ref{tab:country-tab} ranks the proportion of U.S. immigrants in same-sex couples based on country of origin, averaging over the 12 years of survey data. The top sending countries include interesting diversity. Though there are a number of Western countries with more progressive policies in year of departure for immigrants in our sample, notably, Malaysia, Zimbabwe, and Singapore are also in the top 10. Having countries within the top 10 span multiple regions and cultures gives initial support that responses to ACS questions are not being significantly altered due to these differences. Nor does it appear as though responses to the ACS are simply a function of country-of-origin LGB policies as these also vary significantly across the top 10. These patterns provide a level of validity to this measure. Table \ref{tab:state-tab} similarly ranks U.S. state by the proportion of immigrants in same-sex couples, averaging over the period of interest. Although states with progressive policies make the top of the list, Montana, Missouri, and Florida still make the list with less affirming policy environments.


## Model Results
### Country-of-Origin Effects
```{r country-props-mods}
# acs_prop_yrimmig_policy <- acs_prop_yrimmig_policy %>%
#   filter(yrimmig >= 1992)

# ag <- lm(I(log(n_same_sex+1)) ~ origin_score + I(log(n_total+1)), 
#          data = acs_prop_yrimmig_policy) 
# 
# 
# ag_country_orig <- lm(I(log(n_same_sex+1))  ~ distw + contig + comlang_off + comlang_ethno + colony +
#                    wage_dif + unemp_dif + vdem + origin_score + stock_prop+ I(log(n_total+1)), 
#          data = acs_prop_yrimmig_policy)
# 
# ag_country_orig_fe <- lm(I(log(n_same_sex+1))  ~ distw + contig + comlang_off + comlang_ethno + colony +
#                    wage_dif + unemp_dif + vdem + origin_score + stock_prop + bpld+ I(log(n_total+1)), 
#          data = acs_prop_yrimmig_policy)



ag <- lm(prop_same_sex ~ origin_score,
         data = acs_prop_yrimmig_policy)


ag_country_orig <- lm(prop_same_sex ~ distw + contig + comlang_off + comlang_ethno + colony +
                   wage_dif + unemp_dif + vdem + origin_score + stock_prop,
         data = acs_prop_yrimmig_policy)

ag_country_orig_fe <- lm(prop_same_sex ~ distw + contig + comlang_off + comlang_ethno + colony +
                   wage_dif + unemp_dif + vdem + origin_score + stock_prop + bpld,
         data = acs_prop_yrimmig_policy)



# Add binary indicator for post-2013
# ag_country_orig_2013 <- lm(prop_same_sex ~ distw + contig + comlang_off + comlang_ethno + colony +
#                    wage_dif + unemp_dif + vdem + origin_score + stock_prop +
#                      post_2013,
#          data = mutate(acs_prop_yrimmig_policy, post_2013 = (yrimmig > 2013)))

ag_country_orig_fe_2013 <- lm(prop_same_sex ~ distw + contig + comlang_off + comlang_ethno + colony +
                   wage_dif + unemp_dif + vdem + origin_score + stock_prop + bpld +
                     post_2013,
         data = acs_prop_yrimmig_policy)


ag_2013_int_fe <- lm(prop_same_sex ~ distw + contig + comlang_off + comlang_ethno + colony +
                   wage_dif + unemp_dif + vdem  + stock_prop + bpld +
                     post_2013*origin_score,
         data = acs_prop_yrimmig_policy)



```

Our first set of models predicts the percent of immigrants in same-sex couples by country of origin and year of immigration (Table \ref{tab:country-props}). Model 1 regresses this proportion on only our variable of interest, LGB policy score in country of origin. We see that countries with more progressive LGB policies tend to send more immigrants to the U.S. who end up in same-sex couples. The average country-level proportion of immigrants in same-sex couples is only `r mean(acs_prop_yrimmig_policy$prop_same_sex, na.rm = T)` percent, so an increase of `r coef(ag)[[2]]` percent per point increase in LGB policy score represents a substantive effect. Models 2 and 3 in Table \ref{tab:country-props} assess the robustness of this finding. Model 2 includes typical migration controls, including economic differentials, distance, immigrant networks, and democracy. Model 3 adds country-of-origin fixed effects. Although in this model coefficient for origin score is reduced compared to Model 1, it remains statistically significant.


```{r country-props}
se_list <- list()
mod_list <- list(ag, ag_country_orig, ag_country_orig_fe,
                 ag_country_orig_fe_2013, ag_2013_int_fe)
for(mod_num in 1:length(mod_list)){
  se_list[[mod_num]] <- coef(summary(mod_list[[mod_num]], cluster = c("bpld")))[, 2]
}


stargazer(mod_list,
          header = F,
          model.names = F,
          keep = c('origin_score',  'post_2013'),
          order = paste0("^", c('origin_score', 'post_2013TRUE', 
                                'post_2013TRUE:origin_score') , "$"),
          covariate.labels = c('Country LGB policy score',
                                'Post-2013', 'Country score × Post-2013'),
          dep.var.labels   = "Percent in same-sex couples by country-year",
          add.lines = list(c('Country controls?', 'no', rep('yes', 4)),
                           c('Country FEs?', 'no', 'no', rep('yes', 3))),
          se = se_list,
          keep.stat = c('n'),
          star.cutoffs = c(0.1, 0.05, 0.01, 0.001),
          star.char = c('†', '*', '**', '***'),
          notes = c("Note: †p<0.1; *p<0.05; **p<0.01; ***p<0.001",
                    "Source: American Community Survey 2008-2019"),
          notes.label = '',
          notes.align = 'l',
          notes.append = F,
          label = 'tab:country-props',
          title = 'OLS regressions of percent of immigrants in same-sex couples by year of immigration and country of origin. Country-clustered standard errors shown in parentheses. Country controls include population-weighted distance, contiguous border, common official language, common ethnic language, colonial relationship, per-capita GDP differential, unemployment differential, proportion same-country stock, and democracy.')


# mod_list <- list(ag, ag_country_orig, ag_country_orig_fe, 
#                  ag_country_orig_fe_2013, ag_2013_int_fe, ag_2013_spouse_int)
# for(mod_num in 1:length(mod_list)){
#   mod_list[[mod_num]] <- coef(summary(mod_list[[mod_num]], cluster = c("bpld")))
# }
# 
# keep_coefs <- c('Country LGB policy score' = 'origin_score', 
#                 'V-Dem democratization' = 'vdem', 
#                 'Post-2013' = 'post_2013TRUE', 
#                 'Country score × Post-2013' = 'post_2013TRUE:origin_score')
#    
# 
# export_summs(mod_list,
#        coefs = keep_coefs,
#        statistics = c('N' = 'nobs'),
#        stars = c(`†`= 0.1, `*`= 0.05, `**` = 0.01, `***` = 0.001),
#        note = '{stars}. 
#                Source: American Community Survey 2008-2019') %>%
#   set_caption('OLS regressions of percent of immigrants in same-sex couples by year of immigration and country of origin. Country-clustered standard errors shown in parentheses. Country controls include population-weighted distance, contiguous border, common official language, common ethnic language, colonial relationship, per-capita GDP differential, unemployment differential, proportion same-country stock, and democracy.') %>%
#   add_rows(matrix(c('Country controls?', 'no', rep('yes', 5),
#                 'Country FEs?', 'no', 'no', rep('yes', 4)),
#            byrow = T, nrow = 2) , 
#            after = nrow(.) - 1)

```


Models 4 and 5 assess how the 2013 Supreme Court decision striking down DOMA figures into these processes. Model 4 is the same as Model 3, but with a dichotomous "Post-2013" variable added. The influence of sending-country policy loses its significance in this model: 2013 was a significant turning point for LGB immigrants to the U.S., with the average representation from a given country growing by a quarter of a percent. Model 5 adds an interaction between sending-country LGB policy score and the post-2013 dichotomous variable. This variable is significant and positive, while the other variables of interest lose significance. Sending-country policy and the post-2013 era both matter, but solely in tandem: Only LGB immigrants from progressive countries see a boost in representation after the DOMA decision.  

<!-- Finally, Model 6 restricts the sample to only married same-sex couples. Since the DOMA decision permitted visa sponsorship for same-sex spouses, we would expect to see the greatest discontinuity pre- and post-2013 for this sub-population. Indeed, for immigrants married to same-sex spouses the post-2013 variable, and its interaction with sending-country policy score, are both significant and positive. Although before 2013 progressive countries did not send more same-sex married couples, after 2013 these numbers grew sharply, and more progressive countries received an extra boost.  -->

```{r country-sim, eval = F}
# using fixed effects in predictions is hard
ag_2013_int <- lm(prop_same_sex ~ distw + contig + comlang_off + comlang_ethno + colony +
                   wage_dif + unemp_dif + vdem  + stock_prop +
                     post_2013*origin_score,
         data = acs_prop_yrimmig_policy)

## Simulation
set.seed(185)
sims <- 250
sim <- list()
sim_mod <- list(sims)
pseudo_mod <- ag_2013_int
sigma <- vcovCL(ag_2013_int, cluster = ~bpld)
coefs <- ag_2013_int$coefficients
k <- length(coefs)
theta_mat <- rmvnorm(sims, mean = coefs, sigma = sigma)

var <- 'origin_score'

for (i in 1:sims) {
  if(i %% 10 == 0) print(i)
  # print(i)
  theta <- as.numeric(theta_mat[i,])
  pseudo_mod$coefficients <- theta[1:k]
  pseudo_mod$zeta <- theta[(k+1):length(theta)]

  for(cat_loop in unique(acs_prop_yrimmig_policy$post_2013)){
      var_vals <- seq(min(acs_prop_yrimmig_policy[,var]), 
                      max(acs_prop_yrimmig_policy[,var]), 
                      length.out = 50)
      for(val in var_vals){
          sim_dat <- acs_prop_yrimmig_policy %>%
            select(all.vars(formula(ag_2013_int)))
          sim_dat[, 'post_2013'] <- cat_loop
          sim_dat[, var] <- val

          pred_dat <- predict(pseudo_mod, newdata = sim_dat)
          # pred_dat <- data.frame(t(apply(pred_dat, 2, mean))) %>%
          #   pivot_longer(cols = everything(), names_to = 'state_policy', values_to = 'fit')
          
         sim[[paste0(var,cat_loop, val, i)]] <-
          data.frame(fit = mean(pred_dat, na.rm = T),
                            post_2013 = cat_loop,
                            # variable = var,
                            origin_score = val)
      }
  }
}

sim_df <- bind_rows(sim) %>%
  group_by(post_2013, origin_score) %>%
  summarize(fit.low = quantile(fit, .025), fit.high = quantile(fit, .975), fit = mean(fit)) %>%
    mutate(post_2013 = case_when(post_2013 == T ~ 'Post-2013',
                                post_2013 == F ~ '2013 and before'))

write_csv(sim_df, here('draft', 'sim_country.csv'))


# sim <- list()
# var <- 'origin_score'
# for(cat_loop in unique(acs_prop_yrimmig_policy$post_2013)){
#     var_vals <- seq(min(acs_prop_yrimmig_policy[,var]),
#                     max(acs_prop_yrimmig_policy[,var]),
#                     length.out = 50)
#     for(val in var_vals){
#         sim_dat <- acs_prop_yrimmig_policy
#         sim_dat[, 'post_2013'] <- cat_loop
#         sim_dat[, var] <- val
# 
#         pred_dat <- predict(ag_2013_int_fe, newdata = sim_dat, se.fit = T) %>%
#           as.data.frame()
# 
#        sim[[paste0(var,cat_loop, val)]] <- pred_dat %>%
#          summarize(fit = mean(fit, na.rm = T),
#                    se.fit = sqrt(mean(se.fit^2, na.rm = T)),
#                    fit.low = fit - 1.96*se.fit,
#                    fit.high = fit + 1.96*se.fit,
#                           post_2013 = cat_loop,
#                           # variable = var,
#                           origin_score = val)
#     }
# }
# 
# sim_df <- bind_rows(sim) %>%
#     mutate(post_2013 = case_when(post_2013 == T ~ 'Post-2013',
#                                 post_2013 == F ~ '2013 and before'))
```

```{r country-sim2, eval = F}
read_csv(here('draft', 'sim_country.csv')) %>%
  ggplot(aes(x=origin_score, y=fit, col=post_2013)) +
  geom_line() + 
  geom_ribbon(aes(ymin=fit.low, ymax=fit.high, 
                  fill = post_2013, col = NULL), alpha = .2) +
  xlab('LGB policy score for country of origin') +
  ylab('Percentage of immigrants in same-sex couples') +
  theme(legend.justification=c(1,0),
        legend.position=c(.45,.6))
```



### State Effects

```{r state-props}
state_prop <- lm(same_prop ~ state_policy, data = acs_dyad_policy)

state_prop2 <- lm(same_prop ~ origin_score + state_policy, data = acs_dyad_policy)

# state_prop_fe <- lm(same_prop ~ state_unemploy + state_income + state + 
#                         origin_score + state_policy, 
#                        data = acs_dyad_policy)

state_prop_fe <- lm(same_prop ~ state_policy + origin_score + distw + contig + 
                          comlang_off + comlang_ethno + colony +
                          wage_dif + unemp_dif + vdem + stock_prop +
                           state_unemploy + state_income + Country + state, 
                       data = acs_dyad_policy)

state_prop_fe2 <- lm(same_prop ~ state_policy*origin_score + distw + contig + 
                          comlang_off + comlang_ethno + colony +
                          wage_dif + unemp_dif + vdem + stock_prop +
                           state_unemploy + state_income + Country + state, 
                       data = acs_dyad_policy)

state_prop_2013 <- lm(same_prop ~ post_2013 + state_policy + origin_score + distw + contig + 
                          comlang_off + comlang_ethno + colony +
                          wage_dif + unemp_dif + vdem + stock_prop +
                           state_unemploy + state_income + Country + state, 
                       data = mutate(acs_dyad_policy, post_2013 = (year > 2013)))



state_prop_2013_int2 <- lm(same_prop ~ post_2013*state_policy + origin_score + distw + contig + 
                          comlang_off + comlang_ethno + colony +
                          wage_dif + unemp_dif + vdem + stock_prop +
                           state_unemploy + state_income + Country + state, 
                       data = mutate(acs_dyad_policy, post_2013 = (year > 2013)))

state_prop_2013_int <- lm(same_prop ~ post_2013*origin_score + state_policy + distw + contig + 
                          comlang_off + comlang_ethno + colony +
                          wage_dif + unemp_dif + vdem + stock_prop +
                           state_unemploy + state_income + Country + state, 
                       data = mutate(acs_dyad_policy, post_2013 = (year > 2013)))

# state_prop_2013 <- lm(same_prop ~ post_2013*(state_policy + origin_score), 
#                        data = mutate(acs_dyad_policy, post_2013 = (year > 2013)))
# state_prop_2013_2 <- lm(same_prop ~ post_2013*(state_policy + origin_score) + distw + contig + 
#                           comlang_off + comlang_ethno + colony +
#                           wage_dif + unemp_dif + vdem + 
#                            state_unemploy + state_income + Country + state, 
#                        data = mutate(acs_dyad_policy, post_2013 = (year > 2013)))

se_list <- list()
mod_list <- list(state_prop, state_prop2, state_prop_fe, state_prop_fe2, 
                 state_prop_2013, state_prop_2013_int2, state_prop_2013_int)

for(mod_num in 1:length(mod_list)){
  se_list[[mod_num]] <- coef(summary(mod_list[[mod_num]], cluster = c("state", "Country")))[, 2]
}


stargazer(mod_list,
          header = F, 
          keep = c('origin_score', 'state_policy', 'post_2013'),
          # omit = c('Country', 'state'),
          order = paste0("^", c('state_policy', 'origin_score', 
                                'state_policy:origin_score', 'post_2013TRUE', 
                                'post_2013TRUE:state_policy', 
                                'post_2013TRUE:origin_score') , "$"),
          covariate.labels = c('State LGB policy score', 'Country LGB policy score',
                                'State score × country-score', 'Post-2013', 
                               'State score × post-2013', 'Country score × post-2013'),
          dep.var.labels = "Percent in same-sex couples by state-country-year",
          add.lines = list(c('State controls and FEs?', 'no', 'no', rep('yes', 5)),
                           c('Country controls and FEs?', 'no', 'no', rep('yes', 5))),
          se = se_list,
          keep.stat = c('n'),
          star.cutoffs = c(0.1, 0.05, 0.01, 0.001),
          star.char = c('†', '*', '**', '***'),
          notes = c("Note: †p<0.1; *p<0.05; **p<0.01; ***p<0.001", 
                    "Source: American Community Survey 2008-2019"), 
          notes.label = '',
          notes.align = 'l',
          notes.append = F,
          label = 'tab:state-props',
          title = 'Percent same-sex in by country of origin, U.S. state, and survey year. Country and state two-way clustered standard errors are shown in parentheses. State controls include unemployment rate and per-capita income. Country controls include population-weighted distance, contiguous border, common official language, common ethnic language, colonial relationship, per-capita GDP differential, unemployment differential, proportion same-country stock, and democracy.')

origin_effect <- sd(acs_couple_policy$origin_score, na.rm = T)*coef(state_prop2)[['origin_score']]
state_effect <- sd(acs_couple_policy$state_policy, na.rm = T)*coef(state_prop2)[['state_policy']]

```


We next turn to the effects of U.S. state LGB policy. Table \ref{tab:state-props} presents models of the U.S. state-level proportion of immigrants in same-sex couples, from a given country of origin in a given survey year. Model 1 contains only one predictor: U.S. state policy score in the survey year. We see that, on average, states with more friendly LGB policies have somewhat higher proportions of immigrants in same-sex couples. Model 2 adds a predictor for country-of-origin policy score at the mean year of immigration. Although the coefficient for country of origin score is more precisely estimated, the two variables have effects of roughly equal size. A one-standard deviation (`r sd(acs_couple_policy$origin_score, na.rm = T)`-point) increase origin score is associated with a `r origin_effect` percentage-point increase of immigrants in same-sex couples, whereas the corresponding state policy standard deviation increase of `r sd(acs_couple_policy$state_policy, na.rm = T)` points is `r state_effect` percentage points.   

<!-- Although more LGB-friendly policies in both locations are associated with higher numbers of immigrants in same-sex couples, country-of-origin LGB policy is a stronger predictor than U.S. state policy, even considering the somewhat different scale of these variables.    -->

According to the descriptive analysis above, immigrants in same-sex couples tend to have higher incomes and hold more prestigious occupations than immigrants in different-sex couples, and they tend to come from wealthier countries. This implies that immigrants in same-sex couples may be attracted to progressive states for their economic rather than political benefits, so Model 3 adds state and origin-country controls and fixed effects. Surprisingly, the coefficients for state score and country score *grow* in strength. More progressive sending countries are represented by greater proportions of same-sex couples, and they tend to settle in more progressive U.S. states.  


```{r state-sim, eval = F}
state_prop_fe2 <- glm(same_prop ~ state_policy*origin_score + distw + contig + 
                          comlang_off + comlang_ethno + colony +
                          wage_dif + unemp_dif + vdem + stock_prop +
                           state_unemploy + state_income + Country + state, 
                       data = acs_dyad_policy, family = 'poisson')

var1 <- 'state_policy'
var <- 'origin_score'
sim <- list()
for(cat_loop in unique(acs_dyad_policy[,var1])){
    var_vals <- c(min(acs_dyad_policy[,var]), max(acs_dyad_policy[,var]))
    for(val in var_vals){
        sim_dat <- acs_dyad_policy
        sim_dat[, var1] <- cat_loop
        sim_dat[, var] <- val

        pred_dat <- predict(state_prop_fe2, newdata = sim_dat, se.fit = T, 
                            type = 'response') %>%
          as.data.frame()

       sim[[paste0(var,cat_loop, val)]] <- pred_dat %>%
         summarize(fit = mean(fit, na.rm = T),
                   se.fit = sqrt(mean(se.fit^2, na.rm = T)),
                   fit.low = fit - 1.96*se.fit,
                   fit.high = fit + 1.96*se.fit,
                          state_policy = cat_loop,
                          origin_score = val) 
    }
}

sqrt(mean(pred_dat$se.fit^2))
mean(pred_dat$se.fit)

bind_rows(sim) %>%
  write_csv(here('draft', 'sim_state.csv'))


var1 <- 'origin_score'
var <- 'state_policy'
sim <- list()
for(cat_loop in unique(acs_dyad_policy[,var1])){
    var_vals <- c(min(acs_dyad_policy[,var]), max(acs_dyad_policy[,var]))
    for(val in var_vals){
        sim_dat <- acs_dyad_policy
        sim_dat[, var1] <- cat_loop
        sim_dat[, var] <- val

        pred_dat <- predict(state_prop_fe2, newdata = sim_dat, se.fit = T,
                            type = 'response') %>%
          as.data.frame()

       sim[[paste0(var,cat_loop, val)]] <- pred_dat %>%
         summarize(fit = mean(fit, na.rm = T),
                   se.fit = sqrt(mean(se.fit^2, na.rm = T)),
                   fit.low = fit - 1.96*se.fit,
                   fit.high = fit + 1.96*se.fit,
                          origin_score = cat_loop,
                          state_policy = val)
    }
}

bind_rows(sim) %>%
  write_csv(here('draft', 'sim_state2.csv'))

# var1 <- 'state_policy'
# var <- 'origin_score'
# sim <- list()
# for(cat_loop in unique(acs_dyad_policy[,var1])){
#     var_vals <- c(min(acs_dyad_policy[,var]), max(acs_dyad_policy[,var]))
#     for(val in var_vals){
#         sim_dat <- acs_dyad_policy
#         sim_dat[, var1] <- cat_loop
#         sim_dat[, var] <- val
# 
#         pred_dat <- predict(state_prop_fe2, newdata = sim_dat, se.fit = T) %>%
#           as.data.frame()
# 
#        sim[[paste0(var,cat_loop, val)]] <- pred_dat %>%
#          summarize(fit = mean(fit, na.rm = T),
#                    se.fit = sqrt(mean(se.fit^2, na.rm = T)),
#                    fit.low = fit - 1.96*se.fit,
#                    fit.high = fit + 1.96*se.fit,
#                           state_policy = cat_loop,
#                           origin_score = val)
#     }
# }
# 
# bind_rows(sim) %>%
#   write_csv(here('draft', 'sim_state.csv'))
# 
# 
# var1 <- 'origin_score'
# var <- 'state_policy'
# sim <- list()
# for(cat_loop in unique(acs_dyad_policy[,var1])){
#     var_vals <- c(min(acs_dyad_policy[,var]), max(acs_dyad_policy[,var]))
#     for(val in var_vals){
#         sim_dat <- acs_dyad_policy
#         sim_dat[, var1] <- cat_loop
#         sim_dat[, var] <- val
# 
#         pred_dat <- predict(state_prop_fe2, newdata = sim_dat, se.fit = T) %>%
#           as.data.frame()
# 
#        sim[[paste0(var,cat_loop, val)]] <- pred_dat %>%
#          summarize(fit = mean(fit, na.rm = T),
#                    se.fit = sqrt(mean(se.fit^2, na.rm = T)),
#                    fit.low = fit - 1.96*se.fit,
#                    fit.high = fit + 1.96*se.fit,
#                           origin_score = cat_loop,
#                           state_policy = val)
#     }
# }
# 
# bind_rows(sim) %>%
#   write_csv(here('draft', 'sim_state2.csv'))
```

```{r state-sim2, eval = F, fig.cap='Predicted percentage of immigrants in same-sex couples by country-state, using Model 4 from Table 4.'}
plot1 <- read_csv(here('draft', 'sim_state.csv'))  %>%
  mutate(origin_score = ifelse(origin_score == -3, 'Min. country policy', 'Max. country policy')) %>%
  ggplot(aes(x=state_policy, y=fit, col=origin_score)) +
  geom_line() + 
  geom_ribbon(aes(ymin=fit.low, ymax=fit.high, 
                  fill = origin_score, col = NULL), alpha = .2) +
  xlab('U.S. state-of-residence LGB policy score') +
  ylab('') +
  theme(legend.justification=c(1,0),
        legend.position=c(.7,.8))

plot2 <- read_csv(here('draft', 'sim_state2.csv'))  %>%
  mutate(state_policy = ifelse(state_policy == -2, 'Min. U.S. state policy', 'Max. U.S. state policy')) %>%
  ggplot(aes(x=origin_score, y=fit, col=state_policy)) +
  geom_line() + 
  geom_ribbon(aes(ymin=fit.low, ymax=fit.high, 
                  fill = state_policy, col = NULL), alpha = .2) +
  xlab('Country-of-origin LGB policy score') +
  ylab('Percentage of immigrants in same-sex couples') +
  theme(legend.justification=c(1,0),
        legend.position=c(.75,.8))



plot1 + plot2 +  plot_layout(guides = 'keep')
```

Model 4 adds an interaction between state and country LGB scores. It is positive and significant, and the coefficient for state score retains its value while that for country score becomes insignificant. Progressive states attract higher proportions of same-sex immigrant couples, and this effect is stronger for immigrants from more progressive countries. 

<!-- To help with interpretation, we use simulation to predict representation of same-sex couples. The left panel of Figure \ref{fig:state-sim2} has U.S. state LGB policy on the horizontal axis and the percentage of immigrants in same-sex couples depending on vertical axis, with separate prediction lines shown for immigrants originating in countries with the minimum or maximum LGB policy score. As we vary the two hypothetical policy environments, we see that in repressive U.S. states,  -->

Finally, Model 5 includes a dichotomous variable for the post-2013 DOMA decision era, and Models 6 and 7 interact this with state and sending-country scores, respectively. The significant post-2013 variable in Model 5 implies that proportions LGB have increased across the country in the past few years. Coefficients for state policy, including in its interaction with the post-2013 dichotomous variable, become less important in these models, whereas origin-country score retains its effect. After 2013, the proportion of immigrants in same-sex couples increased across states for those from more progressive countries. With increasingly progressive federal policy, state policy appears to matter less in the post-DOMA era.

### Individual Analysis
```{r ord-1}

ord_basic <- polr(state_policy_binned ~ same_sex,
                data = acs_couple_policy_small, Hess = T, weights = perwt/12)
ord_orig <- polr(state_policy_binned ~ same_sex*origin_score,
                data = acs_couple_policy_small, Hess = T, weights = perwt/12)
ord_interact <- polr(state_policy_binned ~ 
                       same_sex*(origin_score + gender + age + educ + 
                   nchild + ihs_income + no_income + yrimmig),
                data = rename(acs_couple_policy_small, gender = sex), Hess = T, weights = perwt/12)

ord_interact_controls <- polr(state_policy_binned ~ 
                                same_sex*(origin_score + gender + age + educ +
                     nchild + ihs_income + no_income + yrimmig) +
                     distw + contig + comlang_off + comlang_ethno +
                     wage_dif + unemp_dif + vdem + stock_prop + #  bpld + state +
                     state_unemploy + state_income,
                data = rename(acs_couple_policy_small, gender = sex), Hess = T, weights = perwt/12)



se_list <- list()
mod_list <- list(ord_basic, ord_orig, ord_interact, ord_interact_controls)
for(mod_num in 1:length(mod_list)){
  se_list[[mod_num]] <- coef(summary(mod_list[[mod_num]], 
                                     cluster = c('bpld', 'state')))[, 2]
}


newdat <- data.frame(same_sex = rep(c(F, T), 12), year = rep(2008:2019, each = 2))
ord_probs <- cbind(newdat,
      predict(ord_basic, 
        newdat,
        type = 'probs')) %>%
  group_by(same_sex) %>%
  summarize(Repressive = mean(Repressive),
            Neutral = mean(Neutral),
            Progressive = mean(Progressive)) 

```


Our final set of models focuses on the individual. Conditional on migrating to the U.S., do immigrants in same-sex couples choose to live in more progressive states than their heterosexual counterparts? Table \ref{tab:ord} presents ordered logit models predicting whether an individual partnered immigrant lives in a U.S. state with repressive, neutral, or progressive LGB policies, pooling data across survey years. Model 1 includes only one regressor: an indicator for whether the immigrant is in a same-sex couple. The positive coefficient indicates that immigrants in same-sex couples indeed tend to live in states with more LGB-friendly policies. The predicted probability for an immigrant in a different-sex couple to live in a state with progressive LGB policies is `r ord_probs[[1, 'Progressive']]`, whereas the corresponding probability for those in same-sex couples rises to `r ord_probs[[2, 'Progressive']]`. The repressive end of the policy spectrum shows reversed trends: The predicted probabilities are `r ord_probs[[1, 'Repressive']]` and `r ord_probs[[2, 'Repressive']]` for different- and same-sex couples, respectively.  

How does country-of-origin context mediate these results? Model 2 adds sending-country LGB policy score at the time of immigration to the regression, interacting it with the same-sex indicator. The coefficient for the same-sex indicator remains positive and significant, but we see opposite effects of the origin-score coefficient for immigrants in different- and same-sex couples. For different-sex couples, hailing from a more progressive country is associated with living in a more repressive U.S. state. For same-sex couples, the result is in the opposite direction: Those from progressive countries tend to live in more progressive U.S. states.  

Model 3 controls for possible individual confounders, interacting them with the same-sex indicator. If immigrants in same-sex couples also tend to have more education, higher income, different family structures, or less years of age, they may be choosing more progressive states due to other policies or economic conditions. Our variables of interest remain strong and in the same directions in this model. Since correlated aspects of sending country and state or residence may be confounding our results, our final individual model adds state and country controls. The coefficient for sending country becomes insignificant, and although they shrink in size, the same-sex coefficient and interaction remain significant. These results are in line with results in Table \ref{tab:state-props}: Same-sex couples are more likely to live in progressive states, and although origin-country score has no relationship with different-sex couples' state policy environment, same-sex couples hailing from more progressive countries are even more likely to live in progressive states.  

```{r ord, results = 'asis'}
obs <- paste0(substr(nrow(acs_couple_policy_small), 1, 3), ',', 
              substr(nrow(acs_couple_policy_small), 4, 6))

stargazer(mod_list,
          header = F, 
          add.lines = list(#c('Survey year FEs?', rep('yes', 3)),
                           c('Individual controls?', 'no', 'no', 'yes', 'yes'),
                           c('State and country controls?', 'no', 'no', 'no', 'yes'),
                           c('Observations', rep(obs, length(mod_list)))
                           ),
          se = se_list,
          omit = c('gender', 'age', 'educ', 'nchild', 'ihs_income', 'no_income', 
                   'yrimmig', 'Constant', 
                   'distw', 'contig', 'comlang_off', 'comlang_ethno',
                    'wage_dif', 'unemp_dif', 'vdem', 'stock_prop',
                     'state_unemploy', 'state_income', 'state'),
          dep.var.labels = c("Binned state LGB policy score"),
          covariate.labels = c('Same-sex', 'Country LGB policy score', 
                               'Same-sex × country score'),
          omit.stat = 'n',
          star.cutoffs = c(0.1, 0.05, 0.01, 0.001),
          star.char = c('†', '*', '**', '***'),
          notes = c("Note: †p<0.1; *p<0.05; **p<0.01; ***p<0.001", 
                    "Source: American Community Survey 2008-2019"), 
          notes.label = '',
          notes.align = 'l',
          notes.append = F,
          #no.space = T,
          label = 'tab:ord',
          title = 'Individual ordered logit analysis of three-category state policy score. Country and state two-way clustered standard errors are shown in parentheses. Individual controls include sex, age, education, number of children, IHS-transformed income, indicator for no income, and year of immigration, which are all interacted with the indicator for same-sex couple. State controls include unemployment rate and per-capita income. Country controls include population-weighted distance, contiguous border, common official language, common ethnic language, colonial relationship, per-capita GDP differential, unemployment differential, proportion same-country stock, and democracy.')
```


```{r sim1, eval = F}



## Simulation
set.seed(185)
sims <- 250
sim <- list()
sim_mod <- list(sims)
pseudo_mod <- ord_interact_controls
k <- length(coef(ord_interact_controls))
sigma_twoway <- vcovCL(ord_interact_controls, cluster = ~ state + bpld)
theta_mat <- rmvnorm(sims, mean=c(coef(ord_interact_controls), ord_interact_controls$zeta),
                              sigma = signif(sigma_twoway, 4))

var <- 'origin_score'

for (i in 1:sims) {
  # if(i %% 10 == 0) print(i)
  print(i)
  theta <- as.numeric(theta_mat[i,])
  pseudo_mod$coefficients <- theta[1:k]
  pseudo_mod$zeta <- theta[(k+1):length(theta)]

  for(same_loop in unique(acs_couple_policy_small$same_sex)){
      var_vals <- seq(min(acs_couple_policy_small[,var]), 
                      max(acs_couple_policy_small[,var]), 
                      length.out = 10)
      for(val in var_vals){
          sim_dat <- acs_couple_policy_small %>%
            rename(gender = sex) %>%
            select(all.vars(formula(ord_interact_controls)))
          sim_dat[, 'same_sex'] <- same_loop
          sim_dat[, var] <- val

          pred_dat <- predict(pseudo_mod, newdata = sim_dat, type = 'probs')
          # pred_dat <- data.frame(t(apply(pred_dat, 2, mean))) %>%
          #   pivot_longer(cols = everything(), names_to = 'state_policy', values_to = 'fit')
          
         sim[[paste0(var,same_loop, val, i)]] <-
          data.frame(t(apply(pred_dat, 2, mean, na.rm = T)),
                            same_sex = same_loop,
                            # variable = var,
                            origin_score = val)
      }
  }
}

sim_df <- bind_rows(sim) %>%
  pivot_longer(1:3, names_to = 'state_policy', values_to = 'fit') %>%
  group_by(same_sex, origin_score, state_policy) %>%
  summarize(fit.low = quantile(fit, .025), fit.high = quantile(fit, .975), fit = mean(fit))

write_csv(sim_df, here('draft', 'sim_df.csv'))
```

```{r sim, eval = F, fig.cap = 'Predicted probabilities of U.S. state LGB policy progressiveness for individual immigrants in different- and same-sex couples, based on policy score of sending country, with 95% confidence intervals.'}
# Mode <- function(x) {
#   ux <- unique(x)
#   ux[which.max(tabulate(match(x, ux)))]
# }
# 
# acs.means <- acs_couple_policy %>% 
#   summarize(across(c(age, origin_score, yrimmig, nchild, ihs_income), mean, na.rm = T))
# acs.modes <- acs_couple_policy %>% 
#   rename(gender = sex) %>%
#   summarize(across(c(educ, no_income, gender), Mode))
# 
# #Make a dataframe that's the mode of the factor variables vs. mean - one row data frame
# #Two dataframes, one for same-sex and one for not. And then make two plots.
# plot.dat <- bind_rows(rep(list(bind_cols(acs.means, acs.modes)),14)) %>%
#   mutate(origin_score = -3:10, year = 2014)
# 
# plot.dat.same <- plot.dat %>%
#   mutate(same_sex = T)
# plot.dat.dif <- plot.dat %>%
#   mutate(same_sex = F)
# 
# # Confidence intervals
# set.seed(1858)
# sims <- 500
# sim_mod <- list(sims)
# pseudo_mod <- ord_interact
# k <- length(coef(ord_interact))
# theta_mat <- rmvnorm(sims, mean=c(coef(ord_interact), ord_interact$zeta),
#                               sigma=vcovCL(ord_interact, cluster = ~ bpld))
# 
# for (i in 1:sims) {
#   theta <- as.numeric(theta_mat[i,])
#   pseudo_mod$coefficients <- theta[1:k]
#   pseudo_mod$zeta <- theta[(k+1):length(theta)]
#   sim_mod[[i]] <- as.data.frame(cbind(i,-3:10, predict(pseudo_mod, 
#                                    newdata=plot.dat.same, type="probs")))
#   names(sim_mod[[i]]) <- c("iter","origin_score", names(sim_mod[[i]])[3:5]) 
# }
# sim_mod_same <- bind_rows(sim_mod) %>%
#   pivot_longer(3:5, names_to = 'state_policy_binned', values_to = 'phat') %>%
#   #gather(state_policy_binned, phat, -iter, -origin_score) %>%
#   group_by(origin_score, state_policy_binned) %>%
#   dplyr::summarize(phat.se = sd(phat),
#                    phat.mean = mean(phat),
#                    phat.lo = phat.mean - 1.96*phat.se,
#                    phat.hi = phat.mean + 1.96*phat.se) %>%
#   mutate(same_sex = 'Same-Sex')
# 
# 
# sims <- 250
# sim_mod <- list(sims)
# pseudo_mod <- ord_interact
# k <- length(coef(ord_interact))
# theta_mat <- rmvnorm(sims, mean=c(coef(ord_interact), ord_interact$zeta),
#                               sigma=vcovCL(ord_interact, cluster = ~ bpld))
# 
# for (i in 1:sims) {
#   theta <- as.numeric(theta_mat[i,])
#   pseudo_mod$coefficients <- theta[1:k]
#   pseudo_mod$zeta <- theta[(k+1):length(theta)]
#   sim_mod[[i]] <- as.data.frame(cbind(i,-3:10, predict(pseudo_mod, 
#                                    newdata=plot.dat.dif, type="probs")))
#   names(sim_mod[[i]]) <- c("iter","origin_score", names(sim_mod[[i]])[3:5]) 
# }
# sim_mod_dif<- bind_rows(sim_mod) %>%
#   pivot_longer(3:5, names_to = 'state_policy_binned', values_to = 'phat') %>%
#   #gather(state_policy_binned, phat, -iter, -origin_score) %>%
#   group_by(origin_score, state_policy_binned) %>%
#   dplyr::summarize(phat.se = sd(phat),
#                    phat.mean = mean(phat),
#                    phat.lo = phat.mean - 1.96*phat.se,
#                    phat.hi = phat.mean + 1.96*phat.se) %>%
#   mutate(same_sex = 'Different-Sex')
# 
# sim_df <- bind_rows(sim_mod_same, sim_mod_dif)
# 
# sim_df %>%
#   ggplot(aes(x=origin_score, y=phat.mean, col=state_policy_binned)) +
#   geom_line() + 
#   geom_ribbon(aes(ymin=phat.lo, ymax=phat.hi, 
#                   fill = state_policy_binned, col = NULL), alpha = .2) +
#   facet_wrap(~same_sex) +
#   xlab('LGB policy score for country of origin') +
#   ylab('Predicted probability of U.S. state residence') +
#   theme(legend.justification=c(1,0),
#         legend.position=c(.95,.38))


sim_df <- read_csv(here('draft', 'sim_df.csv')) %>%
    mutate(same_sex = case_when(same_sex == T ~ 'Same-sex',
                                same_sex == F ~ 'Different-sex'))


sim_df %>%
  ggplot(aes(x=origin_score, y=fit, col=state_policy)) +
  geom_line() + 
  geom_ribbon(aes(ymin=fit.low, ymax=fit.high, 
                  fill = state_policy, col = NULL), alpha = .2) +
  facet_wrap(~same_sex) +
  xlab('LGB policy score for country of origin') +
  ylab('Predicted probability of U.S. state residence') +
  theme(legend.justification=c(1,0),
        legend.position=c(.95,.38))
```

```{r sim-pred}
sim_df <- read_csv(here('draft', 'sim_df.csv')) %>%
    mutate(same_sex = case_when(same_sex == T ~ 'Same-sex',
                                same_sex == F ~ 'Different-sex'))

orig_max <- max(sim_df$origin_score)
same_pred <- filter(sim_df, same_sex == 'Same-sex', origin_score == orig_max, 
       state_policy == 'Progressive') %>% 
  pull(fit)

dif_pred <- filter(sim_df, same_sex == 'Different-sex', origin_score == orig_max, 
       state_policy == 'Progressive') %>% 
  pull(fit)

same_pred2 <- filter(sim_df, same_sex == 'Same-sex', origin_score == orig_max, 
       state_policy == 'Repressive') %>% 
  pull(fit)

dif_pred2 <- filter(sim_df, same_sex == 'Different-sex', origin_score == orig_max, 
       state_policy == 'Repressive') %>% 
  pull(fit)
```

<!-- To help interpret these results, Figure \ref{fig:sim} contains predicted probabilities of residing in progressive, neutral, or repressive U.S. states. For each of 250 simulations, the coefficients are drawn from this covariance matrix as estimated in Model 3 in Table \@ref(tab:ord). These are used to predict the probability of being in each type of state for each member in the complete dataset, with their couple type set to same- or different-sex and their origin score varied from the minimum to maximum. The predicted probabilities are are averaged across the entire dataset for each of these manipulated values. After 250 simulations, the distribution of predicted values is used to find means and 95-percent confidence intervals. The only difference between the two panels is the value for the same-sex indicator in the simulations.   -->

<!-- The figure shows opposite trends for same- and different-sex couples. Overall, immigrants tend to live in more progressive states, but the moderating effect of origin score is quite different for the two groups. The panel for same-sex couples shows that these immigrants tend to live in U.S. states with similar LGB policy contexts to those of their countries of origin.  -->

<!-- These results imply that immigrants in same-sex couples from repressive countries are less likely to live in progressive U.S. states, but as the origin-country score increases, so does the probability of living in a progressive state, while for different-sex couples origin-country LGB score has no effect. For immigrants in different-sex couples, on the other hand, increasingly progressive country-of-origin policies are associated with a *lower* probability of residing in a progressive U.S. state, accompanied by a *higher* probability of living in a repressive U.S. state. -->

We put these results into perspective using simulated probabilities over the entire sample, varying each individual's same-sex indicator and origin-country LGB score. At the high end of the origin-score policy range, typical immigrants in same-sex couples are `r 100*(same_pred - dif_pred)` percentage points more likely to live in progressive states and  `r 100*(dif_pred2 - same_pred2)` percentage points less likely to live in repressive states than similar immigrants in different-sex couples. These results demonstrate that sexuality, and the governance of it, are closely related to migration patterns for those in same-sex relationships.

<!-- Though the pattern for same-sex couples is understandable and expected, the lower probabilities for different-sex couples raises important questions.  -->


## Robustness Checks
```{r sens, eval = T, fig.cap = 'Coefficients for sending-country and U.S. state LGB policy context for fixed effects models in Tables 3 and 4, adjusted for possible misreporting of same-sex couples in pre-2019 data. Ribbon shows 95 percent confidence intervals and blue bars show estimated misreporting from the 2010 and 2016 U.S. Census Bureau tests on the ACS.'}

mod <- lm(partner ~ spouse + I(spouse^2), data.frame(spouse = c(0, .573, .35),
           partner = c(0, .07, .034)))
spouse_vec <- c(.573, .35, seq(from = 0, to = .9, length.out = 20))
mis_df <- data.frame(spouse = spouse_vec,
                     partner = predict(mod, newdata = data.frame(spouse = spouse_vec)))



# mis_df <- data.frame(spouse = c(.573, .35, seq(from = 0, to = .9, length.out = 100)),
#            partner = c(.07, .034, seq(from = 0, to = .3, length.out = 100)))

sens_df <- list()


for(i in 1:nrow(mis_df)){
  sens_mod <- lm(prop_same_sex_adj2 ~ distw + contig + comlang_off + comlang_ethno + colony +
                   wage_dif + unemp_dif + vdem + origin_score + stock_prop + bpld,
         data = acs_prop_yrimmig_policy %>%
                      # mutate(prop_same_sex_adj2 = (prop_spouse_same_sex*(1-mis_df[i,1]) +
                      #                    prop_partner_same_sex*(1-mis_df[i,2])))
           mutate(prop_same_sex_adj2 = (n_spouse_pre_2019_same_sex*(1-mis_df[i,1]) + 
                                         n_spouse_2019_same_sex + 
                                         n_partner_pre_2019_same_sex*(1-mis_df[i,2]) +
                                         n_partner_2019_same_sex)/n_total * 100))
  
  sens_mod2 <- lm(prop_same_sex_adj2 ~ state_policy + origin_score + distw + contig + 
                          comlang_off + comlang_ethno + colony +
                          wage_dif + unemp_dif + vdem + stock_prop +
                           state_unemploy + state_income + Country + state, 
                       data = acs_dyad_policy %>%
                    mutate(prop_same_sex_adj2 = (n_spouse_pre_2019_same_sex*(1-mis_df[i,1]) + 
                                         n_spouse_2019_same_sex + 
                                         n_partner_pre_2019_same_sex*(1-mis_df[i,2]) +
                                         n_partner_2019_same_sex)/state_stock_year * 100))
  
  coef_os <- coef(summary(sens_mod, cluster = c("bpld")))['origin_score',]
  coef_os2 <- coef(summary(sens_mod2, cluster = c("Country", "state'")))['state_policy',]
  coef_os3 <- coef(summary(sens_mod2, cluster = c("Country", "state'")))['origin_score',]
  sens_df[[i]] <- data.frame(est = coef_os[[1]],
                             se = coef_os[[2]],
                             est2 = coef_os2[[1]],
                             se2 = coef_os2[[2]],
                             est3 = coef_os3[[1]],
                             se3 = coef_os3[[2]],
                             mis_spouse = mis_df[i,1],
                             mis_partner = mis_df[i,2])
}

sens_df <- bind_rows(sens_df) %>%
  mutate(lower = est - 1.96*se, 
         upper = est + 1.96*se,
         lower2 = est2 - 1.96*se2, 
         upper2 = est2 + 1.96*se2,
         lower3 = est3 - 1.96*se3, 
         upper3 = est3 + 1.96*se3,
         highlight = mis_spouse %in% c(.573, .35),
         facet = 'Without misreporting in 2019')

# sens_df2 <- list()
# for(i in 1:nrow(mis_df)){
#   sens_mod <- lm(prop_same_sex_adj2 ~ distw + contig + comlang_off + comlang_ethno + colony +
#                    wage_dif + unemp_dif + vdem + origin_score + stock_prop + bpld,
#          data = acs_prop_yrimmig_policy %>%
#                       mutate(prop_same_sex_adj2 = (prop_spouse_same_sex*(1-mis_df[i,1]) +
#                                          prop_partner_same_sex*(1-mis_df[i,2]))))
# 
#   coef_os <- coef(summary(sens_mod, cluster = c("bpld")))['origin_score',]
#   sens_df2[[i]] <- data.frame(est = coef_os[[1]],
#                              se = coef_os[[2]],
#                              mis_spouse = mis_df[i,1],
#                              mis_partner = mis_df[i,2])
# }
# sens_df2 <- bind_rows(sens_df2) %>%
#   mutate(lower = est - 1.96*se,
#          upper = est + 1.96*se,
#          highlight = mis_spouse %in% c(.573, .35),
#          facet = 'Assuming misreporting in 2019') %>%
#   bind_rows(sens_df)



n_spouse <- sum(with(acs_couple_policy, same_sex == T & married == T))
n_partner <- sum(with(acs_couple_policy, same_sex == T & married == F))

add_global_label <- function(pwobj, Xlab = NULL, Ylab = NULL, Xgap = 0.03, Ygap = 0.03, ...) {
    ylabgrob <- patchwork::plot_spacer()
    if (!is.null(Ylab)) {
        ylabgrob <- ggplot() +
            geom_text(aes(x = .5, y = .5), label = Ylab, angle = 90, ...) +
            theme_void()
    }
    if (!is.null(Xlab)) {
        xlabgrob <- ggplot() +
            geom_text(aes(x = .5, y = .5), label = Xlab, ...) +
            theme_void()
    }
    if (!is.null(Ylab) & is.null(Xlab)) {
        return((ylabgrob + patchworkGrob(pwobj)) + 
            patchwork::plot_layout(widths = 100 * c(Ygap, 1 - Ygap)))
    }
    if (is.null(Ylab) & !is.null(Xlab)) {
        return((ylabgrob + pwobj) + 
            (xlabgrob) +
            patchwork::plot_layout(heights = 100 * c(1 - Xgap, Xgap),
                                   widths = c(0, 100),
                                   design = "
                                   AB
                                   CC
                                   "
            ))
    }
    if (!is.null(Ylab) & !is.null(Xlab)) {
        return((ylabgrob + pwobj) + 
            (xlabgrob) +
            patchwork::plot_layout(heights = 100 * c(1 - Xgap, Xgap),
                                   widths = 100 * c(Ygap, 1 - Ygap),
                                   design = "
                                   AB
                                   CC
                                   "
            ))
    }
    return(pwobj)
}

plot1 <- sens_df %>%
  mutate(`Misreporting rate (weighted average)` = (mis_spouse*n_spouse+mis_partner*n_partner)/(n_spouse + n_partner)) %>%
  ggplot(aes(x = `Misreporting rate (weighted average)`, y = est)) +
  geom_line() +
  geom_ribbon(aes(ymin = lower, ymax = upper), alpha = .2)  +
  geom_hline(yintercept = 0, linetype = 'dashed') +
  geom_errorbar(aes(ymin = lower, ymax = upper, width = .02, color = highlight)) +
  # facet_wrap(~facet) +
  theme(legend.position = "none") +
  scale_color_manual(values = c('transparent', RColorBrewer::brewer.pal(3, 'Dark2')[3])) +
  labs(y = 'Coefficient for country score', x = '') +
  ggtitle('Country Model 3')

plot2 <- sens_df %>%
  mutate(`Misreporting rate (weighted average)` = (mis_spouse*n_spouse+mis_partner*n_partner)/(n_spouse + n_partner)) %>%
  ggplot(aes(x = `Misreporting rate (weighted average)`, y = est2)) +
  geom_line() +
  geom_ribbon(aes(ymin = lower2, ymax = upper2), alpha = .2)  +
  geom_hline(yintercept = 0, linetype = 'dashed') +
  geom_errorbar(aes(ymin = lower2, ymax = upper2, width = .02, color = highlight)) +
  #facet_wrap(~facet) +
  theme(legend.position = "none") +
  scale_color_manual(values = c('transparent', RColorBrewer::brewer.pal(3, 'Dark2')[3])) +
  labs(y = 'Coefficient for state score', x = '') +
  ggtitle('State Model 4')

plot3 <- sens_df %>%
  mutate(`Misreporting rate (weighted average)` = (mis_spouse*n_spouse+mis_partner*n_partner)/(n_spouse + n_partner)) %>%
  ggplot(aes(x = `Misreporting rate (weighted average)`, y = est3)) +
  geom_line() +
  geom_ribbon(aes(ymin = lower3, ymax = upper3), alpha = .2)  +
  geom_hline(yintercept = 0, linetype = 'dashed') +
  geom_errorbar(aes(ymin = lower3, ymax = upper3, width = .02, color = highlight)) +
  #facet_wrap(~facet) +
  theme(legend.position = "none") +
  scale_color_manual(values = c('transparent', RColorBrewer::brewer.pal(3, 'Dark2')[3])) +
  labs(y = 'Coefficient for country score', x= '') +
  ggtitle('State Model 4')

(plot1 + plot2 + plot3) %>%
  add_global_label(Xlab = 'Misreporting rate (weighted average)')
```

Our results hold up to a variety of robustness checks presented in the Supplementary Material; we outline the major results here. First, as mentioned above, sex misreporting may bias the results by including a non-trivial number of different-sex couples in the counts of same-sex couples. Published papers using the ACS to study same-sex couples overwhelmingly deal with potential misreporting using the method suggested by @gates_2009 that we employ: dropping respondents whose sex or relation to household head were allocated by the Census Bureau. We conduct a more stringent test of the sensitivity of our results to misreporting, using the empirical mismatch rates by survey response mode from two studies conducted by the Census Bureau in 2010 and 2016 [@kreider_2015; @kreider_2017] to reduce the proportions of immigrants in same-sex couples in data before 2019.^[Beginning in 2019, the ACS added explicit "opposite-sex" and "same-sex" categories for spouses and unmarried partners, so data for this year should be in large part purged of sex misreporting [@walker_2021]. See the Supplementary Material for more details.]  

Here we show the hypothetical effects on our coefficients of even very high misreporting rates. Figure \ref{fig:sens} takes Model 3 from the country proportions models (Table \ref{tab:country-props}) and Model 4 from the state proportions models (Table \ref{tab:state-props}) and reduces the proportions of same-sex couples in the data for pre-2019 data. It varies the percentage of misreported same-sex married couples from 0 to 90 percent and of unmarried couples from 0 to 14 percent; the horizontal axis shows a weighted average of misreporting between these two groups. Highlighted in blue bars are the empirical mismatch rates found in the two studies by @kreider_2015 and @kreider_2017. We see that even extremely high misreporting rates in the pre-2019 ACS do not render these coefficients insignificant. In the supplementary material, we present the coefficients of interest for all of the models in Tables \ref{tab:country-props} and \ref{tab:state-props} with proportions reduced to levels implied by the studies by @kreider_2015 and @kreider_2017. Results are substantively the same.  

Second, although our analysis for the most part has been at the country or state levels, there is the question of whether the aggregate trends in Tables \ref{tab:country-props} and \ref{tab:state-props} are driven by smaller, progressive countries that send relatively few immigrants. Hence in the Supplementary Material we re-specify these models using Weighted Least Squares, weighting by the relative size of the immigrant stock in the year of immigration. Results are substantively the same, with country LGB policy score remaining strong throughout, though the effect of U.S. state LGB policy is somewhat weaker. This implies that, for the typical immigrant, associations with LGB policy at country-or-origin are stronger than those with U.S. state LGB policy.  

Third, we assess whether the results in Table \ref{tab:country-props} are driven by trends for married couples or those with one U.S.-born partner. Limiting the sample to either type of couple does not change our results. Finally, we re-specify individual models with the state policy outcome treated as continuous and estimate linear models using OLS. Results are substantively the same as in Table \ref{tab:ord}.



# Discussion and Conclusion
In 2013, there were `r round(same_2013 /1e3, 1)` thousand same-sex couples that included immigrants in the U.S. By 2019, this number had nearly doubled to `r round(same_2019 /1e3, 1)` thousand. Despite this expansive growth, far outpacing overall migration rates, there is little demographic research investigating the characteristics of these couples or the factors influencing their migratory patterns. The research on queer migrants that does exist is largely qualitative and focused on asylum claims. Consequently, we know little about who these migrants are, why they are leaving their home countries, or where they are choosing to locate once in the U.S. Answering these questions is important, not just because this represents an increasing number of border crossers, but because this process has the potential to reshape our conceptualization of who immigrants are, their motivations for moving, and how policy unrelated to migration can shape the aspirations and capabilities of would-be migrants [@dehaas_2021].  

The rising number of same-sex immigrant couples coincide with a dramatic change in policy environments governing LGB communities, both within the U.S. and abroad. Thanks to the 2013 DOMA Supreme Court case, same-sex couples now have a broader legal pathway into the U.S. [@edwards_2013]. Therefore, although there are numerous perspectives to take, this project intentionally leverages changing policy landscapes at both country-of-origin and U.S. state of residence to understand the migratory patterns of these couples. Engaging in such a question adds to emerging demographic research evaluating how recent policy changes are influencing the health, well-being, and lifestyles of LGB people, while also recognizing that these policies differentially impact LGB people based on different social positions [@boertien_2019; @carpenter_2020; @kail_2015; @levy_2017]. Also, this project contributes to an important gap within migration studies, a field that too often discounts the role of the state and the salience of sexuality in conditioning migratory patterns [@carrillo_2018; @fitzgerald_2014].  

To address our research question, we take advantage of an underutilized data source: self-reports of same-sex immigrant couples in the American Community Survey from 2008 to 2019. Despite this resource being one of the few national surveys to identify same-sex immigrant couples, these data are virtually untapped for this purpose. In light of possible reporting issues with these data [@gates_2013; @goodnature_2021], we probe the sensitivity of our findings only to find remarkable robustness, even to potentially high levels of misreporting. As such, these data allow for us to make one of the first large-$N$ investigations of same-sex immigrant couples within the U.S. and to make an important addition to this area of scholarship, even descriptively.  

Using these data, we make a number of findings worth detailing. First, existing scholarship on immigrants in same-sex couples, and queer migration more broadly, largely focuses on the asylum and refugee processes [@luibheid_2008; @vogler_2016]. This is because this was one of the only mechanisms for getting into the U.S. [@humanrightswatch_2006]. Furthermore, even research on non-refugee LGB immigrants tends to select cases from relatively repressive contexts [@cantu_2009; @carrillo_2018]. Consequently, this over-representation distorts our understanding of who these immigrant  are, the types of environments they are leaving, and their motivations to seek entry into the U.S. Indeed, when comparing the demographics of same-sex immigrant couples to different-sex immigrant couples, we find same-sex couples generally have higher incomes and occupational prestige and are somewhat more educated. Understanding this profile alone is an important insight as it reveals that these communities are of privileged social standing. This is a corrective to the queer migration literature that has yet to highlight this profile. 

Building on our understanding of who these migrants are, how do LGB policies in their countries-of-origin influence their desires to come to the U.S.? Despite existing scholarship portraying a story of LGB couples fleeing repression, same-sex couples in our analysis are leaving countries with more progressive policy environments. As results in Table \ref{tab:country-props} and trendlines in Figure \ref{fig:policy-desc} reveal, couples are coming from environments that are increasingly more open. This is true even after accounting for traditional migration theories that primarily focus on economic costs and benefits and established sociological determinants like networks and cultural proximity. Though more research is needed, these results, in conjunction with the fact that these same-sex couples achieve higher incomes and greater occupational prestige, describe a situation in which perhaps it is precisely due to the supportive policy environment, access to material benefits that come from marriage and employment protections, cultural and state validation of these family formations, and so forth, that enable immigrants to achieve the resources necessary to migrate and seek out partnership. Such an explanation fits within an aspirations-capabilities framework [@dehaas_2021]: Migration is enabled when desires and resources align within an auspicious international opportunity structure. Or, instead of the immediate benefits of the policy itself, these supportive environments may simply encourage LGB people to feel comfortable openly identifying as being in a relationship when responding to surveys. Regardless, it appears that same-sex couples are more apt to follow the lifestyle migration pathways and motivations when coming to the U.S. as opposed to explicitly trying to leave more repressive contexts in hopes of living more open lives.

Once same-sex couples migrate to the U.S., we find that they tend to cluster in states with more progressive policy environments, net of confounders. This finding is important as it helps to address a particular puzzle in LGB international migration. As a whole, the U.S. has less affirming and supportive policies for LGB communities than many countries, both in Europe and Latin America. So why would LGB immigrants from supportive environments choose to come to a country that guarantees fewer rights? One possible answer is that the unique federated system creates variation among U.S. states where more progressive and affirming policy environments can exist, even if the U.S. as a whole may be more repressive. The higher incomes, occupational prestige, and education levels of immigrants in same-sex couples -- as well as greater familiarity with progressive policies in their countries of origin -- may endow them with the necessary capital to understand and navigate the federated U.S. system. This pattern matches research finding U.S.-born LGB individuals to also be more likely to live in states with affirming policies [@beaudin_2017] and research on privileged same-sex immigrant couples in other national contexts able to navigate complex policy environments [@suen_2021_sexual]. An alternative answer as to why LGB immigrants would still migrate to the U.S. is that during his presidency, Barack Obama promoted LGBTQ equality in foreign policy, burnishing an LGB-friendly image of U.S. in the imagination of global communities despite realities.


<!-- One unexpected finding is that different-sex couples from more LGB-friendly countries are likelier to reside in states with increasingly less LGB-friendly policies. These patterns in Figure \ref{fig:sim} are peculiar because we suspected that state LGB policies to have no association with how different-sex couples are making decisions as to where to reside. This is not the case. One immediate question this raises is if this is a case of “straight flight.” White flight is a well-research process in which white people leave diversifying communities. After straight couples experience liberalized conditions for gay couples, do they intentionally seek to leave such conditions by moving to states that are less supportive? Alternatively, it may be that the economic and social forces pulling different-sex immigrants to these particular states may spuriously be associated with less progressive LGB policies. More research is needed to understand this interesting pattern.   -->

These novel insights gleaned from untapped data provide a number of implications and open the door for future research. First, in demonstrating the importance of the state beyond migration-specific policy, the theoretical model presented here can be applicable toward other domains. The state conditioning aspirations and capabilities related to several dimensions of well-being, such as those disaffected by climate policy, can and should be explored. Second, finding that immigrants in same-sex couples are both coming from more open policy environments and are locating in progressive U.S. states opens an important follow-up question: Are there reciprocal effects? Once rights are granted, LGB communities are instrumental toward consolidating new benefits by bringing them to life -- utilizing them, demonstrating supposed negative effects do not occur, and normalizing them to non-LGB communities through interaction [@ocobock_2020_leveraging]. As such, immigrants who once had access to benefits, but no longer do, can be instrumental toward policy changes by similarly bringing benefits to life and themselves becoming agents of change [@ayoub_2019_migration; @ocobock_2020_leveraging; @suen_2021_sexual].  

Third, do different policy environments have differential effects based on couple composition? While our primary motivation is to understand differences between same- and different-sex couples, same-sex couples are a diverse category. Robustness analyses in the appendix disaggregate between two-immigrant and one-immigrant couples to find similar patterns. However, current data limit our ability to understand how couples were established and exact entry processes into the U.S. As such, this limits our understanding if those who come to the U.S. as couples are different than those who form relationships once in the U.S. or the degree to which mixed-status couples are due to U.S. citizens explicitly bringing a partner to the U.S. following tourism or travel abroad.  

Fourth, and relatedly, this is an analysis of cohabiting couples. U.S. immigrants who remain single, whether LGB or straight, or do not cohabit may not follow these same patterns, thus limiting the population to whom we can generalize. More data, especially data on single LGB migrants, is urgently needed. As mentioned, supportive policy environments may both be the result of and further reinforce same-sex coupledom. Consequently, data on single LGB migrants may include a more diverse set of origin policy environments. The focus on couples measured through a self-reported survey may be systematically excluding LGB migrants from less favorable policy environments. Future work on single immigrants is needed to understand the scope of generalizability of these insights. The cultural and geographic variation in responses shown in Table \ref{tab:country-tab} suggests that responses are not a function of culture itself.  

Fifth, though misreporting is documented within the ACS [@gates_2009; @goodnature_2021], our robustness checks following previous work utilizing these data [@goldberg_2021; @christafore_2019; @martell_2020] find remarkably consistent results. And, finally, although we find compelling patterns, our statistical investigation cannot determine why these couples are deciding to migrate to the U.S. and their motivations for choosing their state of residence. We encourage future scholarship to further investigate these processes and mechanisms.  

Recent research has argued that sexuality is a salient factor determining immigration decisions. We show that differences between immigrants in same- and different-sex couples cannot be explained solely using classic theories of migration; policy context and sexuality interact in complicated ways to shape migratory flows. Although our focus is on same-sex couples, this study offers a broader correction to standard models of migration. Lifestyle migration is often used to describe affluent people moving in search of a better way of life [@benson_2009]. But what the present scholarship contributes is that sexuality shapes how that "better way of life" is conceptualized and motivated, contributing toward our understanding these dynamics [@dixon_2020]. The present findings raise additional questions as to how sexuality motivates migration patterns and are (in)directly influencing seemingly economic or networked dynamics, even for heterosexual couples. Finally, to borrow the line from Theda Skocpol, we are "bringing the state back in" [@skocpol_1985]. Typically, state policies are less integrated into models of migration. When they are, the policies under examination are usually those specific to migration. But what this study demonstrates is that, once the DOMA ruling created a legal opening to migration for same-sex couples, it was policy specific to LGB issues, rather than to migration more broadly, that influenced their "pull" to the U.S. This opens up questions as to how state policies relative to a particular group, but not explicitly in the domain of immigration, create structural opportunities for  some communities to leave their home country. This points to the importance of further studying the role of identity, and the state's governance of it, in migratory processes.


# References
\setlength{\parindent}{-0.2in}
\setlength{\leftskip}{0.2in}
\setlength{\parskip}{8pt}
\noindent


